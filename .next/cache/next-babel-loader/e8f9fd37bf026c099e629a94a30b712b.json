{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar _marked = /*#__PURE__*/_regeneratorRuntime.mark(changeWishlistRequest),\n    _marked2 = /*#__PURE__*/_regeneratorRuntime.mark(workWishlistGet),\n    _marked3 = /*#__PURE__*/_regeneratorRuntime.mark(workWishlistPopulate),\n    _marked4 = /*#__PURE__*/_regeneratorRuntime.mark(watchWishlistPopulate),\n    _marked5 = /*#__PURE__*/_regeneratorRuntime.mark(workWishlistChangeItem),\n    _marked6 = /*#__PURE__*/_regeneratorRuntime.mark(watchWishlistChangeItem),\n    _marked7 = /*#__PURE__*/_regeneratorRuntime.mark(watchWishlistGet),\n    _marked8 = /*#__PURE__*/_regeneratorRuntime.mark(_callee);\n\nimport { takeEvery, call, put, select, all } from '@redux-saga/core/effects';\nimport { wishlistGet, wishlistSet, wishlistChangeItem, wishlistChangeItemSuccess, wishlistItemLoading, wishlistPopulate, wishlistPopulateSuccess, wishlistPopulateLoading, wishlistPopulateError, wishlistError } from './action';\nimport { selectAuthorized, selectUser, selectLang } from '../user/reducer';\nimport { setLocalStorageObj, getLocalStorageObj } from '../../constants/utils';\nimport { selectWishlistIds } from './reducer';\nimport Axios from '../services/Axios';\n\nfunction getProductsByIdsRequest(_ref) {\n  var ids = _ref.ids,\n      lang = _ref.lang;\n  return Axios.request({\n    url: '/api/product/byIds',\n    data: {\n      ids: ids,\n      lang: lang\n    },\n    method: 'post'\n  });\n}\n\nfunction changeWishlistRequest(productIds) {\n  return _regeneratorRuntime.wrap(function changeWishlistRequest$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.next = 2;\n          return call(Axios.request, {\n            method: 'post',\n            url: '/api/user/addWish/byIds',\n            data: {\n              type: 'wish',\n              productIds: productIds\n            }\n          });\n\n        case 2:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _marked);\n}\n\nfunction workWishlistGet() {\n  var lang, productIds, ids, _yield$call, result, isAuth;\n\n  return _regeneratorRuntime.wrap(function workWishlistGet$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.prev = 0;\n          _context2.next = 3;\n          return select(selectLang);\n\n        case 3:\n          lang = _context2.sent;\n          // get from local storage\n          productIds = getLocalStorageObj('products').wishlistIds;\n          ids = Object.keys(productIds);\n\n          if (ids.length) {\n            _context2.next = 10;\n            break;\n          }\n\n          _context2.next = 9;\n          return put(wishlistSet({\n            products: [],\n            productIds: {}\n          }));\n\n        case 9:\n          return _context2.abrupt(\"return\");\n\n        case 10:\n          _context2.next = 12;\n          return call(getProductsByIdsRequest, {\n            ids: ids,\n            lang: lang\n          });\n\n        case 12:\n          _yield$call = _context2.sent;\n          result = _yield$call.data.result;\n\n          if (!(result.length !== ids.length)) {\n            _context2.next = 24;\n            break;\n          }\n\n          _context2.next = 17;\n          return select(selectAuthorized);\n\n        case 17:\n          isAuth = _context2.sent;\n          productIds = {};\n          result.forEach(function (_ref2) {\n            var id = _ref2.id;\n            productIds[id] = true;\n          });\n          setLocalStorageObj('products', {\n            wishlistIds: productIds\n          });\n\n          if (!isAuth) {\n            _context2.next = 24;\n            break;\n          }\n\n          _context2.next = 24;\n          return call(changeWishlistRequest, Object.keys(productIds));\n\n        case 24:\n          _context2.next = 26;\n          return put(wishlistSet({\n            products: result,\n            productIds: productIds\n          }));\n\n        case 26:\n          _context2.next = 32;\n          break;\n\n        case 28:\n          _context2.prev = 28;\n          _context2.t0 = _context2[\"catch\"](0);\n          _context2.next = 32;\n          return put(wishlistError());\n\n        case 32:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked2, null, [[0, 28]]);\n}\n\nfunction workWishlistPopulate() {\n  var userWishListArray, userWishlistObj, wishlistIds;\n  return _regeneratorRuntime.wrap(function workWishlistPopulate$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          _context3.prev = 0;\n          _context3.next = 3;\n          return put(wishlistPopulateLoading());\n\n        case 3:\n          _context3.t1 = _objectSpread;\n          _context3.t2 = {};\n          _context3.next = 7;\n          return select(selectUser);\n\n        case 7:\n          _context3.t3 = _context3.sent;\n          _context3.t0 = (0, _context3.t1)(_context3.t2, _context3.t3).wishList;\n\n          if (_context3.t0) {\n            _context3.next = 11;\n            break;\n          }\n\n          _context3.t0 = [];\n\n        case 11:\n          userWishListArray = _context3.t0.map(function (_ref3) {\n            var productId = _ref3.productId;\n            return productId;\n          });\n          userWishlistObj = {};\n          userWishListArray.forEach(function (i) {\n            userWishlistObj[i] = true;\n          });\n          wishlistIds = userWishListArray.length && userWishlistObj || getLocalStorageObj('products') && getLocalStorageObj('products').wishlistIds || {};\n          _context3.next = 17;\n          return put(wishlistPopulateSuccess({\n            wishlistIds: wishlistIds\n          }));\n\n        case 17:\n          setLocalStorageObj('products', {\n            wishlistIds: wishlistIds\n          });\n          _context3.next = 24;\n          break;\n\n        case 20:\n          _context3.prev = 20;\n          _context3.t4 = _context3[\"catch\"](0);\n          _context3.next = 24;\n          return put(wishlistPopulateError());\n\n        case 24:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, _marked3, null, [[0, 20]]);\n}\n\nfunction watchWishlistPopulate() {\n  return _regeneratorRuntime.wrap(function watchWishlistPopulate$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          _context4.next = 2;\n          return takeEvery(wishlistPopulate, workWishlistPopulate);\n\n        case 2:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, _marked4);\n}\n\nfunction setToWishlistRequest(productId) {\n  return Axios.request({\n    method: 'post',\n    url: '/api/user/addWish',\n    data: {\n      productId: productId,\n      type: 'wish'\n    }\n  });\n}\n\nfunction removeFromWishlistRequest(productId) {\n  return Axios.request({\n    method: 'delete',\n    url: '/api/user/removeWish',\n    data: {\n      productId: productId,\n      type: 'wish'\n    }\n  });\n}\n\nfunction workWishlistChangeItem(_ref4) {\n  var productId, authorizedUser, wishlistIds, inWishlist;\n  return _regeneratorRuntime.wrap(function workWishlistChangeItem$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          productId = _ref4.payload.productId;\n          _context5.next = 3;\n          return select(selectAuthorized);\n\n        case 3:\n          authorizedUser = _context5.sent;\n          _context5.next = 6;\n          return put(wishlistItemLoading({\n            id: productId\n          }));\n\n        case 6:\n          _context5.prev = 6;\n          _context5.next = 9;\n          return select(selectWishlistIds);\n\n        case 9:\n          wishlistIds = _context5.sent;\n          inWishlist = !!wishlistIds[productId];\n\n          if (!authorizedUser) {\n            _context5.next = 19;\n            break;\n          }\n\n          if (!inWishlist) {\n            _context5.next = 17;\n            break;\n          }\n\n          _context5.next = 15;\n          return call(removeFromWishlistRequest, productId);\n\n        case 15:\n          _context5.next = 19;\n          break;\n\n        case 17:\n          _context5.next = 19;\n          return call(setToWishlistRequest, productId);\n\n        case 19:\n          wishlistIds[productId] = inWishlist ? null : productId;\n\n          if (inWishlist) {\n            delete wishlistIds[productId];\n          } else wishlistIds[productId] = true;\n\n          _context5.next = 23;\n          return put(wishlistChangeItemSuccess({\n            wishlistIds: _objectSpread({}, wishlistIds),\n            id: productId\n          }));\n\n        case 23:\n          setLocalStorageObj('products', {\n            wishlistIds: wishlistIds\n          });\n          _context5.next = 28;\n          break;\n\n        case 26:\n          _context5.prev = 26;\n          _context5.t0 = _context5[\"catch\"](6);\n\n        case 28:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  }, _marked5, null, [[6, 26]]);\n}\n\nfunction watchWishlistChangeItem() {\n  return _regeneratorRuntime.wrap(function watchWishlistChangeItem$(_context6) {\n    while (1) {\n      switch (_context6.prev = _context6.next) {\n        case 0:\n          _context6.next = 2;\n          return takeEvery(wishlistChangeItem, workWishlistChangeItem);\n\n        case 2:\n        case \"end\":\n          return _context6.stop();\n      }\n    }\n  }, _marked6);\n}\n\nfunction watchWishlistGet() {\n  return _regeneratorRuntime.wrap(function watchWishlistGet$(_context7) {\n    while (1) {\n      switch (_context7.prev = _context7.next) {\n        case 0:\n          _context7.next = 2;\n          return takeEvery(wishlistGet, workWishlistGet);\n\n        case 2:\n        case \"end\":\n          return _context7.stop();\n      }\n    }\n  }, _marked7);\n}\n\nexport default function _callee() {\n  return _regeneratorRuntime.wrap(function _callee$(_context8) {\n    while (1) {\n      switch (_context8.prev = _context8.next) {\n        case 0:\n          _context8.next = 2;\n          return all([watchWishlistGet(), watchWishlistChangeItem(), watchWishlistPopulate()]);\n\n        case 2:\n        case \"end\":\n          return _context8.stop();\n      }\n    }\n  }, _marked8);\n}","map":{"version":3,"sources":["/var/www/mankan-front/store/wishlist/saga.js"],"names":["changeWishlistRequest","workWishlistGet","workWishlistPopulate","watchWishlistPopulate","workWishlistChangeItem","watchWishlistChangeItem","watchWishlistGet","takeEvery","call","put","select","all","wishlistGet","wishlistSet","wishlistChangeItem","wishlistChangeItemSuccess","wishlistItemLoading","wishlistPopulate","wishlistPopulateSuccess","wishlistPopulateLoading","wishlistPopulateError","wishlistError","selectAuthorized","selectUser","selectLang","setLocalStorageObj","getLocalStorageObj","selectWishlistIds","Axios","getProductsByIdsRequest","ids","lang","request","url","data","method","productIds","type","wishlistIds","Object","keys","length","products","result","isAuth","forEach","id","wishList","userWishListArray","map","productId","userWishlistObj","i","setToWishlistRequest","removeFromWishlistRequest","payload","authorizedUser","inWishlist"],"mappings":"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","sourcesContent":["import {\n  takeEvery, call, put, select, all,\n} from '@redux-saga/core/effects';\nimport {\n  wishlistGet,\n  wishlistSet,\n  wishlistChangeItem,\n  wishlistChangeItemSuccess,\n  wishlistItemLoading,\n  wishlistPopulate,\n  wishlistPopulateSuccess,\n  wishlistPopulateLoading,\n  wishlistPopulateError,\n  wishlistError,\n} from './action';\nimport { selectAuthorized, selectUser, selectLang } from '../user/reducer';\nimport {\n  setLocalStorageObj,\n  getLocalStorageObj,\n} from '../../constants/utils';\nimport { selectWishlistIds } from './reducer';\nimport Axios from '../services/Axios';\n\nfunction getProductsByIdsRequest({ ids, lang }) {\n  return Axios.request({\n    url: '/api/product/byIds',\n    data: { ids, lang },\n    method: 'post',\n  });\n}\n\nfunction* changeWishlistRequest(productIds) {\n  yield call(Axios.request, {\n    method: 'post',\n    url: '/api/user/addWish/byIds',\n    data: {\n      type: 'wish',\n      productIds,\n    },\n  });\n}\nfunction* workWishlistGet() {\n  // get products by ids\n  try {\n    const lang = yield select(selectLang);\n    // get from local storage\n    let productIds = getLocalStorageObj('products').wishlistIds;\n    const ids = Object.keys(productIds);\n\n    if (!ids.length) {\n      yield put(wishlistSet({ products: [], productIds: {} }));\n      return;\n    }\n\n    const { data: { result } } = yield call(getProductsByIdsRequest, { ids, lang });\n\n    if (result.length !== ids.length) {\n      const isAuth = yield select(selectAuthorized);\n      productIds = {};\n      result.forEach(({ id }) => { productIds[id] = true; });\n      setLocalStorageObj('products', { wishlistIds: productIds });\n      if (isAuth) {\n        yield call(changeWishlistRequest, Object.keys(productIds));\n      }\n    }\n    yield put(wishlistSet({ products: result, productIds }));\n  } catch (error) {\n    yield put(wishlistError());\n  }\n}\n\n\nfunction* workWishlistPopulate() {\n  try {\n    yield put(wishlistPopulateLoading());\n    const userWishListArray = (({ ...yield select(selectUser) }).wishList\n    || []).map(({ productId }) => productId);\n    const userWishlistObj = {};\n\n    userWishListArray.forEach((i) => { userWishlistObj[i] = true; });\n\n\n    const wishlistIds = (userWishListArray.length && userWishlistObj)\n    || (getLocalStorageObj('products')\n    && getLocalStorageObj('products').wishlistIds) || {};\n\n    yield put(wishlistPopulateSuccess({ wishlistIds }));\n    setLocalStorageObj('products', { wishlistIds });\n  } catch (error) {\n    yield put(wishlistPopulateError());\n  }\n}\n\nfunction* watchWishlistPopulate() {\n  yield takeEvery(wishlistPopulate, workWishlistPopulate);\n}\n\nfunction setToWishlistRequest(productId) {\n  return Axios.request({\n    method: 'post',\n    url: '/api/user/addWish',\n    data: {\n      productId,\n      type: 'wish',\n    },\n  });\n}\nfunction removeFromWishlistRequest(productId) {\n  return Axios.request({\n    method: 'delete',\n    url: '/api/user/removeWish',\n    data: {\n      productId,\n      type: 'wish',\n    },\n  });\n}\n\nfunction* workWishlistChangeItem({ payload: { productId } }) {\n  const authorizedUser = yield select(selectAuthorized);\n  yield put(wishlistItemLoading({ id: productId }));\n  try {\n    const wishlistIds = yield select(selectWishlistIds);\n    const inWishlist = !!wishlistIds[productId];\n\n    if (authorizedUser) {\n      // axios add to send to server to add user wishlistIds\n      if (inWishlist) {\n        yield call(removeFromWishlistRequest, productId);\n      } else {\n        // add to wishlistIds\n        yield call(setToWishlistRequest, productId);\n        // remove from wishlistIds\n      }\n    }\n    wishlistIds[productId] = inWishlist ? null : productId;\n    if (inWishlist) {\n      delete wishlistIds[productId];\n    } else wishlistIds[productId] = true;\n\n\n    yield put(wishlistChangeItemSuccess({\n      wishlistIds: { ...wishlistIds },\n      id: productId,\n    }));\n    setLocalStorageObj('products', { wishlistIds });\n  } catch (error) {\n  }\n}\n\nfunction* watchWishlistChangeItem() {\n  yield takeEvery(wishlistChangeItem, workWishlistChangeItem);\n}\n\n\nfunction* watchWishlistGet() {\n  yield takeEvery(wishlistGet, workWishlistGet);\n}\n\n\nexport default function* () {\n  yield all([\n    watchWishlistGet(),\n    watchWishlistChangeItem(),\n    watchWishlistPopulate(),\n  ]);\n}\n"]},"metadata":{},"sourceType":"module"}