{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _marked = /*#__PURE__*/_regeneratorRuntime.mark(changeUserCart),\n    _marked2 = /*#__PURE__*/_regeneratorRuntime.mark(getCartPageData),\n    _marked3 = /*#__PURE__*/_regeneratorRuntime.mark(getDataByPage),\n    _marked4 = /*#__PURE__*/_regeneratorRuntime.mark(workGetPageData),\n    _marked5 = /*#__PURE__*/_regeneratorRuntime.mark(watchGetPageData),\n    _marked6 = /*#__PURE__*/_regeneratorRuntime.mark(_callee5);\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { all, takeEvery, select, call, put } from 'redux-saga/effects';\nimport { getPageData, getPageDataSuccess, getPageDataError } from './action';\nimport { selectCurrentPage, selectPageId, selectHelperData } from './reducer'; // eslint-disable-next-line import/no-cycle\n\nimport Axios from '../services/Axios';\nimport { selectAuthorized, selectLang } from '../user/reducer';\nimport { cartSetAll } from '../cart/action';\nimport { setLocalStorageObj } from '../../constants/utils';\n\nvar getHomePageData = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(lang) {\n    var _yield$Axios$request, orders, _yield$Axios$request2, result, homePageData, newHomePageData, ExtraProducts, resultKeys;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return Axios.request({\n              url: '/api/product/sliders',\n              method: 'get'\n            });\n\n          case 3:\n            _yield$Axios$request = _context.sent;\n            orders = _yield$Axios$request.data.result.rows;\n            _context.next = 7;\n            return Axios.request({\n              url: '/api/product/homePage',\n              method: 'post',\n              data: {\n                lang: lang\n              }\n            });\n\n          case 7:\n            _yield$Axios$request2 = _context.sent;\n            result = _yield$Axios$request2.data.result;\n            homePageData = [];\n            newHomePageData = [];\n            ExtraProducts = result.ExtraProducts;\n            delete result.ExtraProducts;\n            resultKeys = Object.keys(result);\n            orders.forEach(function (currentOrder, index) {\n              var data = {};\n              resultKeys.forEach(function (key) {\n                if (result[key].sliderId === currentOrder.id) {\n                  data = result[key];\n                }\n              });\n              ExtraProducts.forEach(function (extra) {\n                if (extra.sliderId === currentOrder.id) {\n                  data = extra;\n                }\n              });\n              homePageData[currentOrder.order || 100 * index] = _objectSpread(_objectSpread({}, currentOrder), data);\n            });\n            homePageData.forEach(function (dataItem) {\n              if (dataItem) newHomePageData.push(dataItem);\n            });\n            return _context.abrupt(\"return\", newHomePageData);\n\n          case 19:\n            _context.prev = 19;\n            _context.t0 = _context[\"catch\"](0);\n            return _context.abrupt(\"return\", []);\n\n          case 22:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[0, 19]]);\n  }));\n\n  return function getHomePageData(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nvar getProfilePageData = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            return _context2.abrupt(\"return\", {\n              myOrders: [],\n              viewedProducts: [],\n              untilNextBonusPercent: 50000,\n              nextBonusPercent: 3\n            });\n\n          case 1:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function getProfilePageData() {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nvar getOneProductData = /*#__PURE__*/function () {\n  var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(lang, id) {\n    var _yield$Axios$request3, result;\n\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.next = 2;\n            return Axios.request({\n              method: 'post',\n              url: \"/api/product/\".concat(id),\n              data: {\n                id: id,\n                lang: lang\n              }\n            });\n\n          case 2:\n            _yield$Axios$request3 = _context3.sent;\n            result = _yield$Axios$request3.data.result;\n            return _context3.abrupt(\"return\", {\n              result: result\n            });\n\n          case 5:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n\n  return function getOneProductData(_x2, _x3) {\n    return _ref3.apply(this, arguments);\n  };\n}();\n\nfunction changeUserCart(products) {\n  return _regeneratorRuntime.wrap(function changeUserCart$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          _context4.next = 2;\n          return call(Axios.request, {\n            method: 'post',\n            url: '/api/user/addWish/byIds',\n            data: {\n              type: 'cart',\n              products: products\n            }\n          });\n\n        case 2:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, _marked);\n}\n\nfunction getCartPageData(_ref4) {\n  var lang, cart, ids, _yield$call, cartData, isAuth, newCart, _yield$call2, bugsData;\n\n  return _regeneratorRuntime.wrap(function getCartPageData$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          lang = _ref4.lang, cart = _ref4.cart;\n          ids = Object.keys(cart);\n          _context5.next = 4;\n          return call(Axios.request, {\n            url: '/api/product/byIds',\n            data: {\n              lang: lang,\n              ids: ids\n            },\n            method: 'post'\n          });\n\n        case 4:\n          _yield$call = _context5.sent;\n          cartData = _yield$call.data.result;\n\n          if (!(ids.length !== cartData.length)) {\n            _context5.next = 18;\n            break;\n          }\n\n          _context5.next = 9;\n          return select(selectAuthorized);\n\n        case 9:\n          isAuth = _context5.sent;\n          newCart = {};\n          cartData.forEach(function (_ref5) {\n            var id = _ref5.id;\n            newCart[id] = _objectSpread({}, cart[id]);\n          });\n          _context5.next = 14;\n          return put(cartSetAll({\n            cart: newCart\n          }));\n\n        case 14:\n          setLocalStorageObj('cart', newCart);\n\n          if (!isAuth) {\n            _context5.next = 18;\n            break;\n          }\n\n          _context5.next = 18;\n          return call(changeUserCart, Object.keys(newCart).map(function (key) {\n            return newCart[key];\n          }));\n\n        case 18:\n          _context5.next = 20;\n          return call(Axios.request, {\n            url: '/api/product/bugs',\n            data: {\n              lang: lang\n            },\n            method: 'post'\n          });\n\n        case 20:\n          _yield$call2 = _context5.sent;\n          bugsData = _yield$call2.data.result;\n          return _context5.abrupt(\"return\", {\n            cartData: cartData,\n            bugsData: bugsData\n          });\n\n        case 23:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  }, _marked2);\n}\n\nvar getVacancyPageData = /*#__PURE__*/function () {\n  var _ref7 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(_ref6) {\n    var lang, res;\n    return _regeneratorRuntime.wrap(function _callee4$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            lang = _ref6.lang;\n            _context6.next = 3;\n            return Axios.request({\n              url: '/api/vocation/',\n              data: {\n                lang: lang\n              },\n              method: 'post'\n            });\n\n          case 3:\n            res = _context6.sent;\n            return _context6.abrupt(\"return\", res);\n\n          case 5:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, _callee4);\n  }));\n\n  return function getVacancyPageData(_x4) {\n    return _ref7.apply(this, arguments);\n  };\n}();\n\nfunction getDataByPage(_ref8) {\n  var page, lang, id, data, res, _res, _res2, _res3, _yield$call3, result;\n\n  return _regeneratorRuntime.wrap(function getDataByPage$(_context7) {\n    while (1) {\n      switch (_context7.prev = _context7.next) {\n        case 0:\n          page = _ref8.page, lang = _ref8.lang, id = _ref8.id, data = _ref8.data;\n\n          if (!(page === 'home')) {\n            _context7.next = 6;\n            break;\n          }\n\n          _context7.next = 4;\n          return call(getHomePageData, lang);\n\n        case 4:\n          res = _context7.sent;\n          return _context7.abrupt(\"return\", res);\n\n        case 6:\n          if (!(page === 'profile')) {\n            _context7.next = 11;\n            break;\n          }\n\n          _context7.next = 9;\n          return call(getProfilePageData, lang);\n\n        case 9:\n          _res = _context7.sent;\n          return _context7.abrupt(\"return\", _res);\n\n        case 11:\n          if (!(page === 'oneProduct')) {\n            _context7.next = 16;\n            break;\n          }\n\n          _context7.next = 14;\n          return call(getOneProductData, lang, id);\n\n        case 14:\n          _res2 = _context7.sent;\n          return _context7.abrupt(\"return\", _res2);\n\n        case 16:\n          if (!(page === 'cart')) {\n            _context7.next = 21;\n            break;\n          }\n\n          _context7.next = 19;\n          return call(getCartPageData, {\n            lang: lang,\n            cart: data.cart\n          });\n\n        case 19:\n          _res3 = _context7.sent;\n          return _context7.abrupt(\"return\", _res3);\n\n        case 21:\n          if (!(page === 'vacancy')) {\n            _context7.next = 27;\n            break;\n          }\n\n          _context7.next = 24;\n          return call(getVacancyPageData, {\n            lang: lang\n          });\n\n        case 24:\n          _yield$call3 = _context7.sent;\n          result = _yield$call3.data.result;\n          return _context7.abrupt(\"return\", result);\n\n        case 27:\n          return _context7.abrupt(\"return\", null);\n\n        case 28:\n        case \"end\":\n          return _context7.stop();\n      }\n    }\n  }, _marked3);\n}\n\nfunction workGetPageData(action) {\n  var _action$payload, page, id, data, lang, currentId, currentPage, helperData, res;\n\n  return _regeneratorRuntime.wrap(function workGetPageData$(_context8) {\n    while (1) {\n      switch (_context8.prev = _context8.next) {\n        case 0:\n          _context8.prev = 0;\n          _action$payload = action.payload, page = _action$payload.page, id = _action$payload.id, data = _action$payload.data;\n          _context8.next = 4;\n          return select(selectLang);\n\n        case 4:\n          lang = _context8.sent;\n          _context8.t0 = id;\n\n          if (_context8.t0) {\n            _context8.next = 10;\n            break;\n          }\n\n          _context8.next = 9;\n          return select(selectPageId);\n\n        case 9:\n          _context8.t0 = _context8.sent;\n\n        case 10:\n          currentId = _context8.t0;\n          _context8.t1 = page;\n\n          if (_context8.t1) {\n            _context8.next = 16;\n            break;\n          }\n\n          _context8.next = 15;\n          return select(selectCurrentPage);\n\n        case 15:\n          _context8.t1 = _context8.sent;\n\n        case 16:\n          currentPage = _context8.t1;\n          _context8.t3 = data;\n\n          if (_context8.t3) {\n            _context8.next = 22;\n            break;\n          }\n\n          _context8.next = 21;\n          return select(selectHelperData);\n\n        case 21:\n          _context8.t3 = _context8.sent;\n\n        case 22:\n          _context8.t2 = _context8.t3;\n\n          if (_context8.t2) {\n            _context8.next = 25;\n            break;\n          }\n\n          _context8.t2 = null;\n\n        case 25:\n          helperData = _context8.t2;\n          _context8.next = 28;\n          return call(getDataByPage, {\n            page: currentPage,\n            lang: lang,\n            id: currentId,\n            data: helperData\n          });\n\n        case 28:\n          res = _context8.sent;\n          _context8.next = 31;\n          return put(getPageDataSuccess({\n            data: res,\n            page: currentPage,\n            id: currentId,\n            helperData: helperData\n          }));\n\n        case 31:\n          _context8.next = 37;\n          break;\n\n        case 33:\n          _context8.prev = 33;\n          _context8.t4 = _context8[\"catch\"](0);\n          _context8.next = 37;\n          return put(getPageDataError());\n\n        case 37:\n        case \"end\":\n          return _context8.stop();\n      }\n    }\n  }, _marked4, null, [[0, 33]]);\n}\n\nfunction watchGetPageData() {\n  return _regeneratorRuntime.wrap(function watchGetPageData$(_context9) {\n    while (1) {\n      switch (_context9.prev = _context9.next) {\n        case 0:\n          _context9.next = 2;\n          return takeEvery(getPageData, workGetPageData);\n\n        case 2:\n        case \"end\":\n          return _context9.stop();\n      }\n    }\n  }, _marked5);\n}\n\nexport default function _callee5() {\n  return _regeneratorRuntime.wrap(function _callee5$(_context10) {\n    while (1) {\n      switch (_context10.prev = _context10.next) {\n        case 0:\n          _context10.next = 2;\n          return all([watchGetPageData()]);\n\n        case 2:\n        case \"end\":\n          return _context10.stop();\n      }\n    }\n  }, _marked6);\n}","map":{"version":3,"sources":["/var/www/mankan-front/store/pages-data/saga.js"],"names":["changeUserCart","getCartPageData","getDataByPage","workGetPageData","watchGetPageData","all","takeEvery","select","call","put","getPageData","getPageDataSuccess","getPageDataError","selectCurrentPage","selectPageId","selectHelperData","Axios","selectAuthorized","selectLang","cartSetAll","setLocalStorageObj","getHomePageData","lang","request","url","method","orders","data","result","rows","homePageData","newHomePageData","ExtraProducts","resultKeys","Object","keys","forEach","currentOrder","index","key","sliderId","id","extra","order","dataItem","push","getProfilePageData","myOrders","viewedProducts","untilNextBonusPercent","nextBonusPercent","getOneProductData","products","type","cart","ids","cartData","length","isAuth","newCart","map","bugsData","getVacancyPageData","res","page","action","payload","currentId","currentPage","helperData"],"mappings":"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","sourcesContent":["import {\n  all, takeEvery, select, call, put,\n} from 'redux-saga/effects';\nimport { getPageData, getPageDataSuccess, getPageDataError } from './action';\nimport { selectCurrentPage, selectPageId, selectHelperData } from './reducer';\n// eslint-disable-next-line import/no-cycle\nimport Axios from '../services/Axios';\nimport { selectAuthorized, selectLang } from '../user/reducer';\nimport { cartSetAll } from '../cart/action';\nimport { setLocalStorageObj } from '../../constants/utils';\n\n\nconst getHomePageData = async (lang) => {\n  try {\n    const { data: { result: { rows: orders } } } = await Axios.request({\n      url: '/api/product/sliders',\n      method: 'get',\n    });\n    const { data: { result } } = await Axios.request({\n      url: '/api/product/homePage',\n      method: 'post',\n      data: { lang },\n    });\n    const homePageData = [];\n    const newHomePageData = [];\n\n    const { ExtraProducts } = result;\n    delete result.ExtraProducts;\n    const resultKeys = Object.keys(result);\n\n    orders.forEach((currentOrder, index) => {\n      let data = {};\n      resultKeys.forEach((key) => {\n        if (result[key].sliderId === currentOrder.id) {\n          data = result[key];\n        }\n      });\n\n      ExtraProducts.forEach((extra) => {\n        if (extra.sliderId === currentOrder.id) {\n          data = extra;\n        }\n      });\n      homePageData[currentOrder.order || 100 * index] = { ...currentOrder, ...data };\n    });\n\n    homePageData.forEach((dataItem) => {\n      if (dataItem) newHomePageData.push(dataItem);\n    });\n    return newHomePageData;\n  } catch (error) {\n    return [];\n  }\n};\n\nconst getProfilePageData = async () => ({\n  myOrders: [],\n  viewedProducts: [],\n  untilNextBonusPercent: 50000,\n  nextBonusPercent: 3,\n});\n\nconst getOneProductData = async (lang, id) => {\n  const { data: { result } } = await Axios.request({\n    method: 'post',\n    url: `/api/product/${id}`,\n    data: { id, lang },\n  });\n\n  return { result };\n};\n\nfunction* changeUserCart(products) {\n  yield call(Axios.request, {\n    method: 'post',\n    url: '/api/user/addWish/byIds',\n    data: {\n      type: 'cart',\n      products,\n    },\n  });\n}\n\nfunction* getCartPageData({ lang, cart }) {\n  const ids = Object.keys(cart);\n\n  const { data: { result: cartData } } = yield call(Axios.request, {\n    url: '/api/product/byIds',\n    data: { lang, ids },\n    method: 'post',\n  });\n  if (ids.length !== cartData.length) {\n    const isAuth = yield select(selectAuthorized);\n    const newCart = {};\n    cartData.forEach(({ id }) => {\n      newCart[id] = { ...cart[id] };\n    });\n    yield put(cartSetAll({ cart: newCart }));\n    setLocalStorageObj('cart', newCart);\n    if (isAuth) {\n      yield call(changeUserCart, Object.keys(newCart).map((key) => newCart[key]));\n    }\n  }\n\n  const { data: { result: bugsData } } = yield call(Axios.request, {\n    url: '/api/product/bugs',\n    data: { lang },\n    method: 'post',\n  });\n  return { cartData, bugsData };\n}\n\nconst getVacancyPageData = async ({ lang }) => {\n  const res = await Axios.request({\n    url: '/api/vocation/',\n    data: { lang },\n    method: 'post',\n  });\n  return res;\n};\n\nfunction* getDataByPage({\n  page, lang, id, data,\n}) {\n  if (page === 'home') {\n    const res = yield call(getHomePageData, lang);\n    return res;\n  }\n  if (page === 'profile') {\n    const res = yield call(getProfilePageData, lang);\n    return res;\n  }\n  if (page === 'oneProduct') {\n    const res = yield call(getOneProductData, lang, id);\n\n    return res;\n  }\n  if (page === 'cart') {\n    const res = yield call(getCartPageData, { lang, cart: data.cart });\n\n    return res;\n  }\n\n  if (page === 'vacancy') {\n    const { data: { result } } = yield call(getVacancyPageData, { lang });\n\n    return result;\n  }\n\n  return null;\n}\n\nfunction* workGetPageData(action) {\n  try {\n    const { payload: { page, id, data } } = action;\n\n    const lang = yield select(selectLang);\n    const currentId = id || (yield select(selectPageId));\n    const currentPage = page || (yield select(selectCurrentPage));\n\n    const helperData = data || (yield select(selectHelperData)) || null;\n    const res = yield call(getDataByPage, {\n      page: currentPage, lang, id: currentId, data: helperData,\n    });\n\n    yield put(getPageDataSuccess({\n      data: res, page: currentPage, id: currentId, helperData,\n    }));\n  } catch (error) {\n    yield put(getPageDataError());\n  }\n}\n\nfunction* watchGetPageData() {\n  yield takeEvery(getPageData, workGetPageData);\n}\n\nexport default function* () {\n  yield all([\n    watchGetPageData(),\n  ]);\n}\n"]},"metadata":{},"sourceType":"module"}