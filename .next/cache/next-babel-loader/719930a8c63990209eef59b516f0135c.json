{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nvar _marked = /*#__PURE__*/_regeneratorRuntime.mark(workCatalogGet),\n    _marked2 = /*#__PURE__*/_regeneratorRuntime.mark(watchCatalogGet);\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n// eslint-disable-next-line import/no-extraneous-dependencies\nimport { put, takeLatest, select, call, all } from '@redux-saga/core/effects';\nimport { CancelToken } from 'axios';\nimport Axios from '../services/Axios';\nimport { catalogGet, catalogGetSuccess, catalogGetError } from './action';\nimport { clearFilters, selectCatalogFilters } from '../catalog-filter/reducer';\nimport { selectLang } from '../user/reducer';\nimport { catalogSetFilters } from '../catalog-filter/action';\nimport { CATALOG_PRODUCTS_LIMIT } from './constants';\nvar cancel; // eslint-disable-next-line require-yield\n\nfunction getFilteredDataRequest(data) {\n  return Axios.request({\n    url: '/api/product/fast',\n    method: 'post',\n    data: data,\n    cancelToken: new CancelToken(function (c) {\n      cancel = c;\n    })\n  });\n}\n\nfunction getKey(name) {\n  // brand productSex extraFilter productAge productType productUsage\n  switch (name) {\n    case 'age':\n      return 'productAge';\n\n    case 'gender':\n      return 'productSex';\n\n    case 'type':\n      return 'productType';\n\n    case 'brand':\n      return 'brand';\n\n    case 'meaning':\n      return 'productUsage';\n\n    case 'classification':\n      return 'extraFilter';\n\n    default:\n      return null;\n  }\n}\n\nfunction getBackKey(name) {\n  switch (name) {\n    case 'productAge':\n      return 'age';\n\n    case 'productSex':\n      return 'gender';\n\n    case 'productType':\n      return 'type';\n\n    case 'brand':\n      return 'brand';\n\n    case 'productUsage':\n      return 'meaning';\n\n    case 'extraFilter':\n      return 'classification';\n\n    default:\n      return null;\n  }\n}\n\nfunction workCatalogGet(_ref) {\n  var payload, _filterClone$gender, _filterClone$gender2, _filterClone$price, _filterClone$price2, _filterClone$classifi, _filterClone$classifi2, _filterClone$classifi3, _filterClone$classifi4, _filterClone$gender3, _ref2, page, name, changedNames, selectedPage, filters, catalogFilters, lastFilters, filterName, extraFilterIds, filterClone, lastFilterKeys, filterToSend, _yield$call, _yield$call$data, newFilters, restData;\n\n  return _regeneratorRuntime.wrap(function workCatalogGet$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          payload = _ref.payload;\n          _context.prev = 1;\n          _ref2 = payload || {}, page = _ref2.page, name = _ref2.name, changedNames = _ref2.changedNames; // TODO: remove is triggered\n\n          selectedPage = page || 1;\n          _context.next = 6;\n          return select(clearFilters);\n\n        case 6:\n          filters = _context.sent;\n          _context.next = 9;\n          return select(selectCatalogFilters);\n\n        case 9:\n          catalogFilters = _context.sent;\n          lastFilters = {};\n          filterName = getKey(name);\n\n          if (filterName) {\n            if (filterName && catalogFilters[filterName]) {\n              lastFilters = _defineProperty({}, filterName, catalogFilters[filterName]);\n            }\n          }\n\n          if (changedNames) {\n            changedNames.forEach(function (n) {\n              var fName = getKey(n);\n\n              if (fName) {\n                if (fName && catalogFilters[fName]) {\n                  lastFilters[fName] = catalogFilters[fName];\n                }\n              }\n            });\n          } // brand productSex extraFilter productAge productType productUsage\n\n\n          filters.classification = filters.classification || []; // eslint-disable-next-line no-restricted-globals\n\n          extraFilterIds = !isNaN(+filters.classification[0]) && filters.classification[0];\n          filterClone = JSON.parse(JSON.stringify(filters));\n          lastFilterKeys = [];\n          Object.keys(filterClone).forEach(function (key) {\n            var indexOfAll = filterClone[key].indexOf('all');\n            lastFilterKeys.push(getKey(key));\n\n            if (indexOfAll !== -1 || !filterClone[key].length) {\n              delete filterClone[key];\n              delete lastFilters[getKey(key)];\n            }\n          });\n          Object.keys(lastFilters).forEach(function (key) {\n            if (!filterClone[getBackKey(key)]) {\n              delete lastFilters[key];\n            }\n          });\n          _context.next = 22;\n          return select(selectLang);\n\n        case 22:\n          _context.t0 = _context.sent;\n          _context.t1 = CATALOG_PRODUCTS_LIMIT;\n          _context.t2 = (selectedPage - 1) * CATALOG_PRODUCTS_LIMIT;\n          _context.t3 = extraFilterIds;\n          _context.t4 = filterClone.type;\n          _context.t5 = filterClone.meaning;\n          _context.t6 = filterClone.age;\n          _context.t7 = filterClone.brand;\n          _context.t8 = ((_filterClone$gender = filterClone.gender) === null || _filterClone$gender === void 0 ? void 0 : _filterClone$gender[0]) !== 'ALL' ? filterClone === null || filterClone === void 0 ? void 0 : (_filterClone$gender2 = filterClone.gender) === null || _filterClone$gender2 === void 0 ? void 0 : _filterClone$gender2[0] : undefined;\n          _context.t9 = (filterClone === null || filterClone === void 0 ? void 0 : (_filterClone$price = filterClone.price) === null || _filterClone$price === void 0 ? void 0 : _filterClone$price[0]) || undefined;\n          _context.t10 = (filterClone === null || filterClone === void 0 ? void 0 : (_filterClone$price2 = filterClone.price) === null || _filterClone$price2 === void 0 ? void 0 : _filterClone$price2[1]) || undefined;\n          _context.t11 = (filterClone === null || filterClone === void 0 ? void 0 : (_filterClone$classifi = filterClone.classification) === null || _filterClone$classifi === void 0 ? void 0 : _filterClone$classifi[0]) === 'percent';\n          _context.t12 = (filterClone === null || filterClone === void 0 ? void 0 : (_filterClone$classifi2 = filterClone.classification) === null || _filterClone$classifi2 === void 0 ? void 0 : _filterClone$classifi2[0]) === 'bestSeller';\n          _context.t13 = (filterClone === null || filterClone === void 0 ? void 0 : (_filterClone$classifi3 = filterClone.classification) === null || _filterClone$classifi3 === void 0 ? void 0 : _filterClone$classifi3[0]) === 'isNew';\n          _context.t14 = (filterClone === null || filterClone === void 0 ? void 0 : (_filterClone$classifi4 = filterClone.classification) === null || _filterClone$classifi4 === void 0 ? void 0 : _filterClone$classifi4[0]) === 'priceByAsc';\n          _context.t15 = catalogFilters.searchWord;\n          filterToSend = {\n            lang: _context.t0,\n            limit: _context.t1,\n            offset: _context.t2,\n            extraFilterIds: _context.t3,\n            typeIds: _context.t4,\n            usageIds: _context.t5,\n            ageIds: _context.t6,\n            brandIds: _context.t7,\n            sex: _context.t8,\n            minPrice: _context.t9,\n            maxPrice: _context.t10,\n            percent: _context.t11,\n            bestSeller: _context.t12,\n            isNew: _context.t13,\n            priceByAsc: _context.t14,\n            searchWord: _context.t15\n          };\n\n          if (Array.isArray((_filterClone$gender3 = filterClone.gender) === null || _filterClone$gender3 === void 0 ? void 0 : _filterClone$gender3[0])) {\n            delete filterToSend.sex;\n          }\n\n          if (cancel !== undefined) {\n            cancel();\n          }\n\n          _context.next = 43;\n          return call(getFilteredDataRequest, filterToSend);\n\n        case 43:\n          _yield$call = _context.sent;\n          _yield$call$data = _yield$call.data;\n          newFilters = _yield$call$data.filters;\n          restData = _objectWithoutProperties(_yield$call$data, [\"filters\"]);\n          _context.next = 49;\n          return all([put(catalogGetSuccess({\n            products: restData.result.rows,\n            pagesCount: restData.pages,\n            page: selectedPage\n          }))]);\n\n        case 49:\n          if (!(restData.result.rows.length > 0)) {\n            _context.next = 52;\n            break;\n          }\n\n          _context.next = 52;\n          return put(catalogSetFilters({\n            filters: _objectSpread({\n              productAge: newFilters.age,\n              productType: newFilters.type,\n              productSex: newFilters.productSex,\n              extraFilter: newFilters.extraFilter,\n              productUsage: newFilters.usage,\n              brand: newFilters.brand,\n              searchWord: catalogFilters.searchWord\n            }, lastFilters)\n          }));\n\n        case 52:\n          _context.next = 58;\n          break;\n\n        case 54:\n          _context.prev = 54;\n          _context.t16 = _context[\"catch\"](1);\n          _context.next = 58;\n          return put(catalogGetError());\n\n        case 58:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _marked, null, [[1, 54]]);\n}\n\nfunction watchCatalogGet() {\n  return _regeneratorRuntime.wrap(function watchCatalogGet$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return takeLatest(catalogGet, workCatalogGet);\n\n        case 2:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked2);\n}\n\nexport { watchCatalogGet, workCatalogGet };","map":{"version":3,"sources":["/var/www/mankan-front/store/catalog/saga.js"],"names":["workCatalogGet","watchCatalogGet","put","takeLatest","select","call","all","CancelToken","Axios","catalogGet","catalogGetSuccess","catalogGetError","clearFilters","selectCatalogFilters","selectLang","catalogSetFilters","CATALOG_PRODUCTS_LIMIT","cancel","getFilteredDataRequest","data","request","url","method","cancelToken","c","getKey","name","getBackKey","payload","page","changedNames","selectedPage","filters","catalogFilters","lastFilters","filterName","forEach","n","fName","classification","extraFilterIds","isNaN","filterClone","JSON","parse","stringify","lastFilterKeys","Object","keys","key","indexOfAll","indexOf","push","length","type","meaning","age","brand","gender","undefined","price","searchWord","filterToSend","lang","limit","offset","typeIds","usageIds","ageIds","brandIds","sex","minPrice","maxPrice","percent","bestSeller","isNew","priceByAsc","Array","isArray","newFilters","restData","products","result","rows","pagesCount","pages","productAge","productType","productSex","extraFilter","productUsage","usage"],"mappings":"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","sourcesContent":["// eslint-disable-next-line import/no-extraneous-dependencies\nimport {\n  put, takeLatest, select, call, all,\n} from '@redux-saga/core/effects';\n\n\nimport { CancelToken } from 'axios';\nimport Axios from '../services/Axios';\nimport {\n  catalogGet,\n  catalogGetSuccess,\n  catalogGetError,\n\n} from './action';\nimport { clearFilters, selectCatalogFilters } from '../catalog-filter/reducer';\nimport { selectLang } from '../user/reducer';\nimport { catalogSetFilters } from '../catalog-filter/action';\nimport { CATALOG_PRODUCTS_LIMIT } from './constants';\n\n\nlet cancel;\n\n\n// eslint-disable-next-line require-yield\nfunction getFilteredDataRequest(data) {\n  return Axios.request({\n    url: '/api/product/fast',\n    method: 'post',\n    data,\n    cancelToken: new CancelToken(((c) => {\n      cancel = c;\n    })),\n  });\n}\n\nfunction getKey(name) {\n  // brand productSex extraFilter productAge productType productUsage\n  switch (name) {\n    case 'age':\n      return 'productAge';\n    case 'gender':\n      return 'productSex';\n    case 'type':\n      return 'productType';\n    case 'brand':\n      return 'brand';\n    case 'meaning':\n      return 'productUsage';\n    case 'classification':\n      return 'extraFilter';\n\n    default:\n      return null;\n  }\n}\n\nfunction getBackKey(name) {\n  switch (name) {\n    case 'productAge':\n      return 'age';\n    case 'productSex':\n      return 'gender';\n    case 'productType':\n      return 'type';\n    case 'brand':\n      return 'brand';\n    case 'productUsage':\n      return 'meaning';\n    case 'extraFilter':\n      return 'classification';\n\n    default:\n      return null;\n  }\n}\nfunction* workCatalogGet({ payload }) {\n  try {\n    const { page, name, changedNames } = (payload || {}); // TODO: remove is triggered\n    const selectedPage = page || 1;\n\n    const filters = yield select(clearFilters);\n\n\n    const catalogFilters = yield select(selectCatalogFilters);\n\n\n    let lastFilters = {};\n    const filterName = getKey(name);\n    if (filterName) {\n      if (filterName && catalogFilters[filterName]) {\n        lastFilters = {\n          [filterName]: catalogFilters[filterName],\n        };\n      }\n    }\n\n    if (changedNames) {\n      changedNames.forEach((n) => {\n        const fName = getKey(n);\n        if (fName) {\n          if (fName && catalogFilters[fName]) {\n            lastFilters[fName] = catalogFilters[fName];\n          }\n        }\n      });\n    }\n    // brand productSex extraFilter productAge productType productUsage\n\n    filters.classification = filters.classification || [];\n    // eslint-disable-next-line no-restricted-globals\n    const extraFilterIds = !isNaN(+filters.classification[0]) && filters.classification[0];\n\n    const filterClone = JSON.parse(JSON.stringify(filters));\n\n    const lastFilterKeys = [];\n    Object.keys(filterClone).forEach((key) => {\n      const indexOfAll = filterClone[key].indexOf('all');\n      lastFilterKeys.push(getKey(key));\n      if (indexOfAll !== -1 || !filterClone[key].length) {\n        delete filterClone[key];\n        delete lastFilters[getKey(key)];\n      }\n    });\n\n    Object.keys(lastFilters).forEach((key) => {\n      if (!filterClone[getBackKey(key)]) {\n        delete lastFilters[key];\n      }\n    });\n\n    const filterToSend = {\n      lang: yield select(selectLang),\n      limit: CATALOG_PRODUCTS_LIMIT,\n      offset: (selectedPage - 1) * CATALOG_PRODUCTS_LIMIT,\n      extraFilterIds,\n      typeIds: filterClone.type,\n      usageIds: filterClone.meaning,\n      ageIds: filterClone.age,\n      brandIds: filterClone.brand,\n      sex: filterClone.gender?.[0] !== 'ALL' ? filterClone?.gender?.[0] : undefined,\n      minPrice: filterClone?.price?.[0] || undefined,\n      maxPrice: filterClone?.price?.[1] || undefined,\n      percent: filterClone?.classification?.[0] === 'percent',\n      bestSeller: filterClone?.classification?.[0] === 'bestSeller',\n      isNew: filterClone?.classification?.[0] === 'isNew',\n      priceByAsc: filterClone?.classification?.[0] === 'priceByAsc',\n      searchWord: catalogFilters.searchWord,\n    };\n    if (Array.isArray(filterClone.gender?.[0])) {\n      delete filterToSend.sex;\n    }\n\n    if (cancel !== undefined) {\n      cancel();\n    }\n\n\n    const { data: { filters: newFilters, ...restData } } = yield call(getFilteredDataRequest, filterToSend);\n\n\n    yield all([\n      put(catalogGetSuccess({\n        products: restData.result.rows,\n        pagesCount: restData.pages,\n        page: selectedPage,\n      })),\n    ]);\n\n\n    if (restData.result.rows.length > 0) {\n      yield put(catalogSetFilters({\n        filters: {\n          productAge: newFilters.age,\n          productType: newFilters.type,\n          productSex: newFilters.productSex,\n          extraFilter: newFilters.extraFilter,\n          productUsage: newFilters.usage,\n          brand: newFilters.brand,\n          searchWord: catalogFilters.searchWord,\n          ...lastFilters,\n        },\n      }));\n    }\n  } catch (error) {\n    yield put(catalogGetError());\n  }\n}\n\nfunction* watchCatalogGet() {\n  yield takeLatest(catalogGet, workCatalogGet);\n}\n\nexport { watchCatalogGet, workCatalogGet };\n"]},"metadata":{},"sourceType":"module"}