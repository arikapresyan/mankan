{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nvar _marked = /*#__PURE__*/_regeneratorRuntime.mark(workLogin),\n    _marked2 = /*#__PURE__*/_regeneratorRuntime.mark(watchLogin),\n    _marked3 = /*#__PURE__*/_regeneratorRuntime.mark(workRegistration),\n    _marked4 = /*#__PURE__*/_regeneratorRuntime.mark(watchRegistration),\n    _marked5 = /*#__PURE__*/_regeneratorRuntime.mark(workGetUserData),\n    _marked6 = /*#__PURE__*/_regeneratorRuntime.mark(watchGetUserData),\n    _marked7 = /*#__PURE__*/_regeneratorRuntime.mark(workLogout),\n    _marked8 = /*#__PURE__*/_regeneratorRuntime.mark(workSetLang),\n    _marked9 = /*#__PURE__*/_regeneratorRuntime.mark(watchSetLang),\n    _marked10 = /*#__PURE__*/_regeneratorRuntime.mark(watchLogout);\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { takeEvery, put, all, call, select } from '@redux-saga/core/effects';\nimport Router from 'next/router';\nimport { message } from 'antd';\nimport Axios from '../services/Axios';\nimport { registration, loginSuccess, logoutSuccess, login, setLang, authorizationError, resetUserReducer, logout, authorizationLoading, getUserData, getUserDataSuccess, getUserDataError } from './action';\nimport { hideAll } from '../userEventListeners/action';\nimport { wishlistPopulate } from '../wishlist/action';\nimport { C_TOKEN, removeLocalStorageObj } from '../../constants/utils';\nimport { populateCart } from '../cart/action';\nimport { selectAuthorized, selectLang, selectUser } from './reducer';\nimport { getPageData } from '../pages-data/action';\nimport { deleteCookie, getCookie, setCookie } from '../../utils/cookies';\n\nfunction loginRequest(params) {\n  return Axios.request({\n    method: 'post',\n    url: '/api/user/signIn',\n    data: params\n  });\n}\n\nfunction workLogin(_ref) {\n  var _ref$payload, emailOrPhone, password, rememberMe, lang, _yield$call, _yield$call$data, token, result, _error$response, _error$response$data, errorMessage;\n\n  return _regeneratorRuntime.wrap(function workLogin$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _ref$payload = _ref.payload, emailOrPhone = _ref$payload.emailOrPhone, password = _ref$payload.password, rememberMe = _ref$payload.rememberMe;\n          _context.prev = 1;\n          _context.next = 4;\n          return select(selectLang);\n\n        case 4:\n          lang = _context.sent;\n          _context.next = 7;\n          return put(authorizationLoading());\n\n        case 7:\n          _context.next = 9;\n          return call(loginRequest, {\n            userName: emailOrPhone,\n            password: password,\n            rememberMe: rememberMe,\n            lang: lang\n          });\n\n        case 9:\n          _yield$call = _context.sent;\n          _yield$call$data = _yield$call.data;\n          token = _yield$call$data.token;\n          result = _yield$call$data.result;\n\n          if (rememberMe) {\n            setCookie(C_TOKEN, token, {\n              'max-age': 100 * 24 * 60 * 60\n            });\n          } else {\n            setCookie(C_TOKEN, token);\n          }\n\n          _context.next = 16;\n          return put(loginSuccess(_objectSpread({}, result)));\n\n        case 16:\n          removeLocalStorageObj('cart');\n          removeLocalStorageObj('products');\n          _context.next = 20;\n          return put(getPageData({}));\n\n        case 20:\n          _context.next = 22;\n          return put(wishlistPopulate());\n\n        case 22:\n          _context.next = 24;\n          return put(populateCart());\n\n        case 24:\n          _context.next = 31;\n          break;\n\n        case 26:\n          _context.prev = 26;\n          _context.t0 = _context[\"catch\"](1);\n          errorMessage = (_context.t0 === null || _context.t0 === void 0 ? void 0 : (_error$response = _context.t0.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || 'Something went wrong';\n          _context.next = 31;\n          return all([put(authorizationError({\n            errorText: errorMessage\n          })), put(resetUserReducer())]);\n\n        case 31:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _marked, null, [[1, 26]]);\n}\n\nfunction watchLogin() {\n  return _regeneratorRuntime.wrap(function watchLogin$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return takeEvery(login, workLogin);\n\n        case 2:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked2);\n}\n\nfunction registrationRequest(params) {\n  return Axios.request({\n    method: 'post',\n    url: '/api/user/signUp',\n    data: params\n  });\n}\n\nfunction workRegistration(_ref2) {\n  var _ref2$payload, email, password, phone, agreeTerms, name, surname, _ref2$payload$success, successText, _error$response2, _error$response2$data;\n\n  return _regeneratorRuntime.wrap(function workRegistration$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          _ref2$payload = _ref2.payload, email = _ref2$payload.email, password = _ref2$payload.password, phone = _ref2$payload.phone, agreeTerms = _ref2$payload.agreeTerms, name = _ref2$payload.name, surname = _ref2$payload.surname, _ref2$payload$success = _ref2$payload.successText, successText = _ref2$payload$success === void 0 ? 'Please, confirm email' : _ref2$payload$success;\n          _context3.next = 3;\n          return put(authorizationLoading());\n\n        case 3:\n          _context3.prev = 3;\n          _context3.next = 6;\n          return call(registrationRequest, {\n            email: email,\n            password: password,\n            retryPassword: password,\n            phone: phone,\n            agreeTerms: agreeTerms,\n            firstName: name,\n            lastName: surname,\n            isAcceptedRules: agreeTerms\n          });\n\n        case 6:\n          message.success({\n            content: successText,\n            duration: 5\n          });\n          _context3.next = 9;\n          return all([put(hideAll()), put(resetUserReducer())]);\n\n        case 9:\n          _context3.next = 15;\n          break;\n\n        case 11:\n          _context3.prev = 11;\n          _context3.t0 = _context3[\"catch\"](3);\n          _context3.next = 15;\n          return all([put(authorizationError({\n            errorText: (_context3.t0 === null || _context3.t0 === void 0 ? void 0 : (_error$response2 = _context3.t0.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.message) || 'No server response'\n          })), put(resetUserReducer())]);\n\n        case 15:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, _marked3, null, [[3, 11]]);\n}\n\nfunction watchRegistration() {\n  return _regeneratorRuntime.wrap(function watchRegistration$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          _context4.next = 2;\n          return takeEvery(registration, workRegistration);\n\n        case 2:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, _marked4);\n}\n\nfunction getUserDataRequest(token) {\n  return Axios.request({\n    method: 'get',\n    url: \"/api/user/info/\".concat(token)\n  });\n}\n\nfunction workGetUserData() {\n  var token, _yield$call2, result;\n\n  return _regeneratorRuntime.wrap(function workGetUserData$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          token = getCookie(C_TOKEN);\n          _context5.prev = 1;\n\n          if (token) {\n            _context5.next = 4;\n            break;\n          }\n\n          throw new Error();\n\n        case 4:\n          _context5.next = 6;\n          return call(getUserDataRequest, token);\n\n        case 6:\n          _yield$call2 = _context5.sent;\n          result = _yield$call2.data.result;\n          _context5.next = 10;\n          return put(getUserDataSuccess());\n\n        case 10:\n          _context5.next = 12;\n          return put(loginSuccess(_objectSpread({}, result)));\n\n        case 12:\n          localStorage.setItem('lang', result.lang);\n          _context5.next = 21;\n          break;\n\n        case 15:\n          _context5.prev = 15;\n          _context5.t0 = _context5[\"catch\"](1);\n\n          if (_context5.t0.response) {\n            localStorage.removeItem('cart');\n            sessionStorage.removeItem('cart');\n            localStorage.removeItem('products');\n            sessionStorage.removeItem('products');\n          }\n\n          deleteCookie(C_TOKEN);\n          _context5.next = 21;\n          return put(getUserDataError());\n\n        case 21:\n          _context5.prev = 21;\n          _context5.next = 24;\n          return all([put(wishlistPopulate()), put(populateCart())]);\n\n        case 24:\n          _context5.next = 28;\n          break;\n\n        case 26:\n          _context5.prev = 26;\n          _context5.t1 = _context5[\"catch\"](21);\n\n        case 28:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  }, _marked5, null, [[1, 15], [21, 26]]);\n}\n\nfunction watchGetUserData() {\n  return _regeneratorRuntime.wrap(function watchGetUserData$(_context6) {\n    while (1) {\n      switch (_context6.prev = _context6.next) {\n        case 0:\n          _context6.next = 2;\n          return takeEvery(getUserData, workGetUserData);\n\n        case 2:\n        case \"end\":\n          return _context6.stop();\n      }\n    }\n  }, _marked6);\n}\n\nfunction workLogout() {\n  var user;\n  return _regeneratorRuntime.wrap(function workLogout$(_context7) {\n    while (1) {\n      switch (_context7.prev = _context7.next) {\n        case 0:\n          _context7.prev = 0;\n          _context7.next = 3;\n          return select(selectUser);\n\n        case 3:\n          user = _context7.sent;\n\n          if (user.id) {\n            _context7.next = 6;\n            break;\n          }\n\n          return _context7.abrupt(\"return\");\n\n        case 6:\n          deleteCookie(C_TOKEN);\n          localStorage.removeItem('products');\n          localStorage.removeItem('cart');\n          Router.push('/');\n          _context7.next = 12;\n          return put(logoutSuccess());\n\n        case 12:\n          _context7.next = 14;\n          return put(wishlistPopulate());\n\n        case 14:\n          _context7.next = 16;\n          return put(populateCart());\n\n        case 16:\n          _context7.next = 22;\n          break;\n\n        case 18:\n          _context7.prev = 18;\n          _context7.t0 = _context7[\"catch\"](0);\n          _context7.next = 22;\n          return put(authorizationError({\n            errorText: 'logout error'\n          }));\n\n        case 22:\n        case \"end\":\n          return _context7.stop();\n      }\n    }\n  }, _marked7, null, [[0, 18]]);\n}\n\nfunction changeLangRequest(data) {\n  return Axios.request({\n    url: '/api/user/changeLang',\n    method: 'put',\n    data: data\n  });\n}\n\nfunction workSetLang(_ref3) {\n  var payload, isAuth;\n  return _regeneratorRuntime.wrap(function workSetLang$(_context8) {\n    while (1) {\n      switch (_context8.prev = _context8.next) {\n        case 0:\n          payload = _ref3.payload;\n          _context8.prev = 1;\n          _context8.next = 4;\n          return select(selectAuthorized);\n\n        case 4:\n          isAuth = _context8.sent;\n\n          if (!isAuth) {\n            _context8.next = 8;\n            break;\n          }\n\n          _context8.next = 8;\n          return call(changeLangRequest, payload);\n\n        case 8:\n          localStorage.setItem('lang', payload.lang);\n          _context8.next = 13;\n          break;\n\n        case 11:\n          _context8.prev = 11;\n          _context8.t0 = _context8[\"catch\"](1);\n\n        case 13:\n        case \"end\":\n          return _context8.stop();\n      }\n    }\n  }, _marked8, null, [[1, 11]]);\n}\n\nfunction watchSetLang() {\n  return _regeneratorRuntime.wrap(function watchSetLang$(_context9) {\n    while (1) {\n      switch (_context9.prev = _context9.next) {\n        case 0:\n          _context9.next = 2;\n          return takeEvery(setLang, workSetLang);\n\n        case 2:\n        case \"end\":\n          return _context9.stop();\n      }\n    }\n  }, _marked9);\n}\n\nfunction watchLogout() {\n  return _regeneratorRuntime.wrap(function watchLogout$(_context10) {\n    while (1) {\n      switch (_context10.prev = _context10.next) {\n        case 0:\n          _context10.next = 2;\n          return takeEvery(logout, workLogout);\n\n        case 2:\n        case \"end\":\n          return _context10.stop();\n      }\n    }\n  }, _marked10);\n}\n\nexport { watchLogin, watchRegistration, watchLogout, watchGetUserData, watchSetLang };","map":null,"metadata":{},"sourceType":"module"}