{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nvar _marked = /*#__PURE__*/_regeneratorRuntime.mark(workLogin),\n    _marked2 = /*#__PURE__*/_regeneratorRuntime.mark(watchLogin),\n    _marked3 = /*#__PURE__*/_regeneratorRuntime.mark(workRegistration),\n    _marked4 = /*#__PURE__*/_regeneratorRuntime.mark(watchRegistration),\n    _marked5 = /*#__PURE__*/_regeneratorRuntime.mark(workGetUserData),\n    _marked6 = /*#__PURE__*/_regeneratorRuntime.mark(watchGetUserData),\n    _marked7 = /*#__PURE__*/_regeneratorRuntime.mark(workLogout),\n    _marked8 = /*#__PURE__*/_regeneratorRuntime.mark(workSetLang),\n    _marked9 = /*#__PURE__*/_regeneratorRuntime.mark(watchSetLang),\n    _marked10 = /*#__PURE__*/_regeneratorRuntime.mark(watchLogout);\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { takeEvery, put, all, call, select } from '@redux-saga/core/effects';\nimport Router from 'next/router';\nimport message from 'antd/lib/message';\nimport Axios from '../services/Axios';\nimport { registration, loginSuccess, logoutSuccess, login, setLang, authorizationError, resetUserReducer, logout, authorizationLoading, getUserData, getUserDataSuccess, getUserDataError } from './action';\nimport { hideAll } from '../userEventListeners/action';\nimport { wishlistPopulate } from '../wishlist/action';\nimport { C_TOKEN, removeLocalStorageObj } from '../../constants/utils';\nimport { populateCart } from '../cart/action';\nimport { selectAuthorized, selectLang, selectUser } from './reducer';\nimport { getPageData } from '../pages-data/action';\nimport { deleteCookie, getCookie, setCookie } from '../../utils/cookies';\n\nfunction loginRequest(params) {\n  return Axios.request({\n    method: 'post',\n    url: '/api/user/signIn',\n    data: params\n  });\n}\n\nfunction workLogin(_ref) {\n  var _ref$payload, emailOrPhone, password, rememberMe, lang, _yield$call, _yield$call$data, token, result, _error$response, _error$response$data, errorMessage;\n\n  return _regeneratorRuntime.wrap(function workLogin$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _ref$payload = _ref.payload, emailOrPhone = _ref$payload.emailOrPhone, password = _ref$payload.password, rememberMe = _ref$payload.rememberMe;\n          _context.prev = 1;\n          _context.next = 4;\n          return select(selectLang);\n\n        case 4:\n          lang = _context.sent;\n          _context.next = 7;\n          return put(authorizationLoading());\n\n        case 7:\n          _context.next = 9;\n          return call(loginRequest, {\n            userName: emailOrPhone,\n            password: password,\n            rememberMe: rememberMe,\n            lang: lang\n          });\n\n        case 9:\n          _yield$call = _context.sent;\n          _yield$call$data = _yield$call.data;\n          token = _yield$call$data.token;\n          result = _yield$call$data.result;\n\n          if (rememberMe) {\n            setCookie(C_TOKEN, token, {\n              'max-age': 100 * 24 * 60 * 60\n            });\n          } else {\n            setCookie(C_TOKEN, token);\n          }\n\n          _context.next = 16;\n          return put(loginSuccess(_objectSpread({}, result)));\n\n        case 16:\n          removeLocalStorageObj('cart');\n          removeLocalStorageObj('products');\n          _context.next = 20;\n          return put(getPageData({}));\n\n        case 20:\n          _context.next = 22;\n          return put(wishlistPopulate());\n\n        case 22:\n          _context.next = 24;\n          return put(populateCart());\n\n        case 24:\n          _context.next = 31;\n          break;\n\n        case 26:\n          _context.prev = 26;\n          _context.t0 = _context[\"catch\"](1);\n          errorMessage = (_context.t0 === null || _context.t0 === void 0 ? void 0 : (_error$response = _context.t0.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || 'Something went wrong';\n          _context.next = 31;\n          return all([put(authorizationError({\n            errorText: errorMessage\n          })), put(resetUserReducer())]);\n\n        case 31:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _marked, null, [[1, 26]]);\n}\n\nfunction watchLogin() {\n  return _regeneratorRuntime.wrap(function watchLogin$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return takeEvery(login, workLogin);\n\n        case 2:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked2);\n}\n\nfunction registrationRequest(params) {\n  return Axios.request({\n    method: 'post',\n    url: '/api/user/signUp',\n    data: params\n  });\n}\n\nfunction workRegistration(_ref2) {\n  var _ref2$payload, email, password, phone, agreeTerms, name, surname, _ref2$payload$success, successText, _error$response2, _error$response2$data;\n\n  return _regeneratorRuntime.wrap(function workRegistration$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          _ref2$payload = _ref2.payload, email = _ref2$payload.email, password = _ref2$payload.password, phone = _ref2$payload.phone, agreeTerms = _ref2$payload.agreeTerms, name = _ref2$payload.name, surname = _ref2$payload.surname, _ref2$payload$success = _ref2$payload.successText, successText = _ref2$payload$success === void 0 ? 'Please, confirm email' : _ref2$payload$success;\n          _context3.next = 3;\n          return put(authorizationLoading());\n\n        case 3:\n          _context3.prev = 3;\n          _context3.next = 6;\n          return call(registrationRequest, {\n            email: email,\n            password: password,\n            retryPassword: password,\n            phone: phone,\n            agreeTerms: agreeTerms,\n            firstName: name,\n            lastName: surname,\n            isAcceptedRules: agreeTerms\n          });\n\n        case 6:\n          message.success({\n            content: successText,\n            duration: 5\n          });\n          _context3.next = 9;\n          return all([put(hideAll()), put(resetUserReducer())]);\n\n        case 9:\n          _context3.next = 15;\n          break;\n\n        case 11:\n          _context3.prev = 11;\n          _context3.t0 = _context3[\"catch\"](3);\n          _context3.next = 15;\n          return all([put(authorizationError({\n            errorText: (_context3.t0 === null || _context3.t0 === void 0 ? void 0 : (_error$response2 = _context3.t0.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.message) || 'No server response'\n          })), put(resetUserReducer())]);\n\n        case 15:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, _marked3, null, [[3, 11]]);\n}\n\nfunction watchRegistration() {\n  return _regeneratorRuntime.wrap(function watchRegistration$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          _context4.next = 2;\n          return takeEvery(registration, workRegistration);\n\n        case 2:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, _marked4);\n}\n\nfunction getUserDataRequest(token) {\n  return Axios.request({\n    method: 'get',\n    url: \"/api/user/info/\".concat(token)\n  });\n}\n\nfunction workGetUserData() {\n  var token, _yield$call2, result;\n\n  return _regeneratorRuntime.wrap(function workGetUserData$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          token = getCookie(C_TOKEN);\n          _context5.prev = 1;\n\n          if (token) {\n            _context5.next = 4;\n            break;\n          }\n\n          throw new Error();\n\n        case 4:\n          _context5.next = 6;\n          return call(getUserDataRequest, token);\n\n        case 6:\n          _yield$call2 = _context5.sent;\n          result = _yield$call2.data.result;\n          _context5.next = 10;\n          return put(getUserDataSuccess());\n\n        case 10:\n          _context5.next = 12;\n          return put(loginSuccess(_objectSpread({}, result)));\n\n        case 12:\n          localStorage.setItem('lang', result.lang);\n          _context5.next = 21;\n          break;\n\n        case 15:\n          _context5.prev = 15;\n          _context5.t0 = _context5[\"catch\"](1);\n\n          if (_context5.t0.response) {\n            localStorage.removeItem('cart');\n            sessionStorage.removeItem('cart');\n            localStorage.removeItem('products');\n            sessionStorage.removeItem('products');\n          }\n\n          deleteCookie(C_TOKEN);\n          _context5.next = 21;\n          return put(getUserDataError());\n\n        case 21:\n          _context5.prev = 21;\n          _context5.next = 24;\n          return all([put(wishlistPopulate()), put(populateCart())]);\n\n        case 24:\n          _context5.next = 28;\n          break;\n\n        case 26:\n          _context5.prev = 26;\n          _context5.t1 = _context5[\"catch\"](21);\n\n        case 28:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  }, _marked5, null, [[1, 15], [21, 26]]);\n}\n\nfunction watchGetUserData() {\n  return _regeneratorRuntime.wrap(function watchGetUserData$(_context6) {\n    while (1) {\n      switch (_context6.prev = _context6.next) {\n        case 0:\n          _context6.next = 2;\n          return takeEvery(getUserData, workGetUserData);\n\n        case 2:\n        case \"end\":\n          return _context6.stop();\n      }\n    }\n  }, _marked6);\n}\n\nfunction workLogout() {\n  var user;\n  return _regeneratorRuntime.wrap(function workLogout$(_context7) {\n    while (1) {\n      switch (_context7.prev = _context7.next) {\n        case 0:\n          _context7.prev = 0;\n          _context7.next = 3;\n          return select(selectUser);\n\n        case 3:\n          user = _context7.sent;\n\n          if (user.id) {\n            _context7.next = 6;\n            break;\n          }\n\n          return _context7.abrupt(\"return\");\n\n        case 6:\n          deleteCookie(C_TOKEN);\n          localStorage.removeItem('products');\n          localStorage.removeItem('cart');\n          Router.push('/');\n          _context7.next = 12;\n          return put(logoutSuccess());\n\n        case 12:\n          _context7.next = 14;\n          return put(wishlistPopulate());\n\n        case 14:\n          _context7.next = 16;\n          return put(populateCart());\n\n        case 16:\n          _context7.next = 22;\n          break;\n\n        case 18:\n          _context7.prev = 18;\n          _context7.t0 = _context7[\"catch\"](0);\n          _context7.next = 22;\n          return put(authorizationError({\n            errorText: 'logout error'\n          }));\n\n        case 22:\n        case \"end\":\n          return _context7.stop();\n      }\n    }\n  }, _marked7, null, [[0, 18]]);\n}\n\nfunction changeLangRequest(data) {\n  return Axios.request({\n    url: '/api/user/changeLang',\n    method: 'put',\n    data: data\n  });\n}\n\nfunction workSetLang(_ref3) {\n  var payload, isAuth;\n  return _regeneratorRuntime.wrap(function workSetLang$(_context8) {\n    while (1) {\n      switch (_context8.prev = _context8.next) {\n        case 0:\n          payload = _ref3.payload;\n          _context8.prev = 1;\n          _context8.next = 4;\n          return select(selectAuthorized);\n\n        case 4:\n          isAuth = _context8.sent;\n\n          if (!isAuth) {\n            _context8.next = 8;\n            break;\n          }\n\n          _context8.next = 8;\n          return call(changeLangRequest, payload);\n\n        case 8:\n          localStorage.setItem('lang', payload.lang);\n          _context8.next = 13;\n          break;\n\n        case 11:\n          _context8.prev = 11;\n          _context8.t0 = _context8[\"catch\"](1);\n\n        case 13:\n        case \"end\":\n          return _context8.stop();\n      }\n    }\n  }, _marked8, null, [[1, 11]]);\n}\n\nfunction watchSetLang() {\n  return _regeneratorRuntime.wrap(function watchSetLang$(_context9) {\n    while (1) {\n      switch (_context9.prev = _context9.next) {\n        case 0:\n          _context9.next = 2;\n          return takeEvery(setLang, workSetLang);\n\n        case 2:\n        case \"end\":\n          return _context9.stop();\n      }\n    }\n  }, _marked9);\n}\n\nfunction watchLogout() {\n  return _regeneratorRuntime.wrap(function watchLogout$(_context10) {\n    while (1) {\n      switch (_context10.prev = _context10.next) {\n        case 0:\n          _context10.next = 2;\n          return takeEvery(logout, workLogout);\n\n        case 2:\n        case \"end\":\n          return _context10.stop();\n      }\n    }\n  }, _marked10);\n}\n\nexport { watchLogin, watchRegistration, watchLogout, watchGetUserData, watchSetLang };","map":{"version":3,"sources":["/var/www/mankan-front/store/user/saga.js"],"names":["workLogin","watchLogin","workRegistration","watchRegistration","workGetUserData","watchGetUserData","workLogout","workSetLang","watchSetLang","watchLogout","takeEvery","put","all","call","select","Router","message","Axios","registration","loginSuccess","logoutSuccess","login","setLang","authorizationError","resetUserReducer","logout","authorizationLoading","getUserData","getUserDataSuccess","getUserDataError","hideAll","wishlistPopulate","C_TOKEN","removeLocalStorageObj","populateCart","selectAuthorized","selectLang","selectUser","getPageData","deleteCookie","getCookie","setCookie","loginRequest","params","request","method","url","data","payload","emailOrPhone","password","rememberMe","lang","userName","token","result","errorMessage","response","errorText","registrationRequest","email","phone","agreeTerms","name","surname","successText","retryPassword","firstName","lastName","isAcceptedRules","success","content","duration","getUserDataRequest","Error","localStorage","setItem","removeItem","sessionStorage","user","id","push","changeLangRequest","isAuth"],"mappings":"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","sourcesContent":["import {\n  takeEvery, put, all, call, select,\n} from '@redux-saga/core/effects';\nimport Router from 'next/router';\nimport  message  from 'antd/lib/message';\nimport Axios from '../services/Axios';\nimport {\n  registration,\n  loginSuccess,\n  logoutSuccess,\n  login,\n  setLang,\n  authorizationError,\n  resetUserReducer,\n  logout,\n  authorizationLoading,\n  getUserData,\n  getUserDataSuccess,\n  getUserDataError,\n} from './action';\nimport { hideAll } from '../userEventListeners/action';\nimport { wishlistPopulate } from '../wishlist/action';\nimport { C_TOKEN, removeLocalStorageObj } from '../../constants/utils';\nimport { populateCart } from '../cart/action';\nimport { selectAuthorized, selectLang, selectUser } from './reducer';\nimport { getPageData } from '../pages-data/action';\nimport { deleteCookie, getCookie, setCookie } from '../../utils/cookies';\n\n\nfunction loginRequest(params) {\n  return Axios.request({\n    method: 'post',\n    url: '/api/user/signIn',\n    data: params,\n  });\n}\n\nfunction* workLogin({\n  payload: {\n    emailOrPhone,\n    password,\n    rememberMe,\n  },\n}) {\n  try {\n    const lang = yield select(selectLang);\n    yield put(authorizationLoading());\n    const { data: { token, result } } = yield call(loginRequest,\n      {\n        userName: emailOrPhone,\n        password,\n        rememberMe,\n        lang,\n      });\n    if (rememberMe) {\n      setCookie(C_TOKEN, token, { 'max-age': 100 * 24 * 60 * 60 });\n    } else {\n      setCookie(C_TOKEN, token);\n    }\n\n    yield put(\n      loginSuccess({\n        ...result,\n      }),\n    );\n\n    removeLocalStorageObj('cart');\n    removeLocalStorageObj('products');\n    yield put(getPageData({}));\n    yield put(wishlistPopulate());\n    yield put(populateCart());\n  } catch (error) {\n    const errorMessage = error?.response?.data?.message || 'Something went wrong';\n    yield all([\n      put(\n        authorizationError({\n          errorText: errorMessage,\n        }),\n      ),\n      put(\n        resetUserReducer(),\n      ),\n    ]);\n  }\n}\n\nfunction* watchLogin() {\n  yield takeEvery(login, workLogin);\n}\n\nfunction registrationRequest(params) {\n  return Axios.request({\n    method: 'post',\n    url: '/api/user/signUp',\n    data: params,\n  });\n}\n\nfunction* workRegistration({\n  payload: {\n    email,\n    password,\n    phone,\n    agreeTerms,\n    name,\n    surname,\n    successText = 'Please, confirm email',\n  },\n}) {\n  yield put(authorizationLoading());\n\n  try {\n    yield call(registrationRequest, {\n      email,\n      password,\n      retryPassword: password,\n      phone,\n      agreeTerms,\n      firstName: name,\n      lastName: surname,\n      isAcceptedRules: agreeTerms,\n    });\n    message.success({ content: successText, duration: 5 });\n\n    yield all([\n      put(hideAll()),\n      put(resetUserReducer()),\n    ]);\n  } catch (error) {\n    yield all([\n      put(\n        authorizationError({\n          errorText: error?.response?.data?.message || 'No server response',\n        }),\n      ),\n      put(\n        resetUserReducer(),\n      ),\n    ]);\n  }\n}\nfunction* watchRegistration() {\n  yield takeEvery(registration, workRegistration);\n}\n\nfunction getUserDataRequest(token) {\n  return Axios.request({\n    method: 'get',\n    url: `/api/user/info/${token}`,\n  });\n}\n\nfunction* workGetUserData() {\n  const token = getCookie(C_TOKEN);\n\n  try {\n    if (!token) throw new Error();\n    const { data: { result } } = yield call(getUserDataRequest, token);\n\n    yield put(getUserDataSuccess());\n    yield put(loginSuccess({ ...result }));\n    localStorage.setItem('lang', result.lang);\n  } catch (error) {\n    if (error.response) {\n      localStorage.removeItem('cart');\n      sessionStorage.removeItem('cart');\n      localStorage.removeItem('products');\n      sessionStorage.removeItem('products');\n    }\n    deleteCookie(C_TOKEN);\n    yield put(getUserDataError());\n  }\n\n  try {\n    yield all([\n      put(wishlistPopulate()),\n      put(populateCart()),\n    ]);\n  } catch (error) {\n  }\n}\n\n\nfunction* watchGetUserData() {\n  yield takeEvery(getUserData, workGetUserData);\n}\n\n\nfunction* workLogout() {\n  try {\n    const user = yield select(selectUser);\n    if (!user.id) return;\n    deleteCookie(C_TOKEN);\n    localStorage.removeItem('products');\n    localStorage.removeItem('cart');\n    Router.push('/');\n    yield put(logoutSuccess());\n    yield put(wishlistPopulate());\n    yield put(populateCart());\n  } catch (error) {\n    yield put(authorizationError({ errorText: 'logout error' }));\n  }\n}\nfunction changeLangRequest(data) {\n  return Axios.request({\n    url: '/api/user/changeLang',\n    method: 'put',\n    data,\n  });\n}\n\nfunction* workSetLang({ payload }) {\n  try {\n    const isAuth = yield select(selectAuthorized);\n    if (isAuth) {\n      yield call(changeLangRequest, payload);\n    }\n    localStorage.setItem('lang', payload.lang);\n  } catch (e) {\n  }\n}\nfunction* watchSetLang() {\n  yield takeEvery(setLang, workSetLang);\n}\nfunction* watchLogout() {\n  yield takeEvery(logout, workLogout);\n}\nexport {\n  watchLogin,\n  watchRegistration,\n  watchLogout,\n  watchGetUserData,\n  watchSetLang,\n};\n"]},"metadata":{},"sourceType":"module"}