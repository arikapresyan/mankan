{"ast":null,"code":"var _jsxFileName = \"/var/www/mankan-front/components/modals/buy-product-modal/useBuyProductModal.js\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useState, useMemo, useEffect, useCallback } from 'react';\nimport { useIntl } from 'react-intl';\nimport router from 'next/router';\nimport useCartActions from '../../../store/cart/useCartActions';\nimport { getProductSizeFromObj, getBonus, getProductBrand, getProductAge, getProductBattery, addToCartObj } from '../../../constants/utils';\nimport keys from '../../../constants/keys';\nimport useGetProductPrice from '../../../hooks/useGetProductPrice';\nvar IMAGE_POSTFIX = keys.IMAGE_POSTFIX;\n\nfunction useBuyProductModal(_ref) {\n  _s();\n\n  var _this = this;\n\n  var product = _ref.product,\n      localChanges = _ref.localChanges,\n      handleHideModal = _ref.handleHideModal,\n      bonus = _ref.bonus;\n\n  var _useCartActions = useCartActions(),\n      cartAddProductAction = _useCartActions.cartAddProductAction;\n\n  var _useIntl = useIntl(),\n      messages = _useIntl.messages;\n\n  var text = __jsx(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 20,\n      columnNumber: 16\n    }\n  }, messages['local.modal_battery']);\n\n  var size = product.size,\n      brand = product.brand,\n      id = product.id,\n      percent = product.percent,\n      price = product.price,\n      accessories = product.accessories,\n      photos = product.photos,\n      xmlCount = product.xmlCount,\n      xmlBarCode = product.xmlBarCode;\n\n  var _useState = useState(false),\n      hasBattery = _useState[0],\n      setHasBattery = _useState[1];\n\n  var _useState2 = useState(localChanges[product.id] && localChanges[product.id].count || product.count || 1),\n      count = _useState2[0],\n      setCount = _useState2[1];\n\n  var battery = useMemo(function () {\n    return getProductBattery(accessories);\n  }, [accessories]);\n  useEffect(function () {\n    if (battery && localChanges[id] && (localChanges[id].hasBattery || localChanges[id].batteryId) && battery.xmlCount) {\n      setHasBattery(true);\n    }\n  }, [battery, localChanges]);\n  var batteryText = useMemo(function () {\n    return battery && \"\".concat(battery.ProductAccessoriesMap.count, \"  \").concat(messages['local.item(s)'], \" \").concat(battery.name);\n  }, [battery, messages]);\n  var brandName = useMemo(function () {\n    return getProductBrand(brand);\n  }, [brand]);\n  var sizeText = useMemo(function () {\n    return getProductSizeFromObj(size);\n  }, [size]);\n  var productAga = useMemo(function () {\n    return getProductAge(product.minAge, product.maxAge);\n  }, [product.minAge, product.maxAge]);\n  var photo = useMemo(function () {\n    var firstPhoto = photos ? photos.sort(function (a, b) {\n      return a.order - b.order;\n    })[0] : null;\n    if (!firstPhoto) return {};\n    return {\n      url: \"\".concat(IMAGE_POSTFIX).concat(id, \"/\").concat(firstPhoto.url),\n      alt: firstPhoto.alt,\n      title: firstPhoto.title\n    };\n  }, [photos]);\n\n  var _useGetProductPrice = useGetProductPrice(product),\n      newPrice = _useGetProductPrice.newPrice,\n      oldPrice = _useGetProductPrice.oldPrice;\n\n  var bonusText = useMemo(function () {\n    return getBonus(newPrice, bonus || 2, count);\n  }, [newPrice, bonus, count]);\n  var priceBayCount = useMemo(function () {\n    return newPrice * count;\n  }, [newPrice, count]);\n\n  var addToCart = function addToCart(redirect) {\n    cartAddProductAction(addToCartObj({\n      hasBattery: hasBattery,\n      battery: battery,\n      count: count,\n      product: product\n    }), router.router.route === '/cart' || redirect);\n    handleHideModal();\n  };\n\n  var addToCartAndRedirect = function addToCartAndRedirect() {\n    addToCart(true);\n  };\n\n  var text2 = useCallback(function () {\n    return __jsx(\"span\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 11\n      }\n    }, messages['local.can_use_bonus_if']);\n  }, [messages]);\n  return {\n    addToCartAndRedirect: addToCartAndRedirect,\n    addToCart: addToCart,\n    bonusText: bonusText,\n    batteryText: batteryText,\n    brandName: brandName,\n    sizeText: sizeText,\n    photo: photo,\n    text: text,\n    setCount: setCount,\n    messages: messages,\n    xmlPrice: oldPrice,\n    percent: percent,\n    battery: battery,\n    productAga: productAga,\n    text2: text2,\n    id: id,\n    count: count,\n    hasBattery: hasBattery,\n    setHasBattery: setHasBattery,\n    price: price,\n    xmlCount: xmlCount,\n    xmlBarCode: xmlBarCode,\n    priceBayCount: priceBayCount\n  };\n}\n\n_s(useBuyProductModal, \"ZMKD6xpmW6kOtJ6gO0tHdyLUM1E=\", false, function () {\n  return [useCartActions, useIntl, useGetProductPrice];\n});\n\nexport default useBuyProductModal;","map":{"version":3,"sources":["/var/www/mankan-front/components/modals/buy-product-modal/useBuyProductModal.js"],"names":["React","useState","useMemo","useEffect","useCallback","useIntl","router","useCartActions","getProductSizeFromObj","getBonus","getProductBrand","getProductAge","getProductBattery","addToCartObj","keys","useGetProductPrice","IMAGE_POSTFIX","useBuyProductModal","product","localChanges","handleHideModal","bonus","cartAddProductAction","messages","text","size","brand","id","percent","price","accessories","photos","xmlCount","xmlBarCode","hasBattery","setHasBattery","count","setCount","battery","batteryId","batteryText","ProductAccessoriesMap","name","brandName","sizeText","productAga","minAge","maxAge","photo","firstPhoto","sort","a","b","order","url","alt","title","newPrice","oldPrice","bonusText","priceBayCount","addToCart","redirect","route","addToCartAndRedirect","text2","xmlPrice"],"mappings":"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","sourcesContent":["import React, {\n  useState, useMemo, useEffect, useCallback,\n} from 'react';\nimport { useIntl } from 'react-intl';\nimport router from 'next/router';\nimport useCartActions from '../../../store/cart/useCartActions';\nimport {\n  getProductSizeFromObj, getBonus, getProductBrand, getProductAge, getProductBattery, addToCartObj,\n} from '../../../constants/utils';\nimport keys from '../../../constants/keys';\nimport useGetProductPrice from '../../../hooks/useGetProductPrice';\n\nconst { IMAGE_POSTFIX } = keys;\n\nfunction useBuyProductModal({\n  product, localChanges, handleHideModal, bonus,\n}) {\n  const { cartAddProductAction } = useCartActions();\n  const { messages } = useIntl();\n  const text = <span>{messages['local.modal_battery']}</span>;\n\n\n  const {\n    size,\n    brand,\n    id,\n    percent,\n    price,\n    accessories,\n    photos,\n    xmlCount,\n    xmlBarCode,\n  } = product;\n  const [hasBattery, setHasBattery] = useState(false);\n\n  const [count, setCount] = useState(\n    (localChanges[product.id] && localChanges[product.id].count)\n    || product.count\n    || 1,\n  );\n  const battery = useMemo(() => getProductBattery(accessories), [accessories]);\n  useEffect(() => {\n    if (\n      battery\n       && localChanges[id]\n       && (localChanges[id].hasBattery || localChanges[id].batteryId)\n       && battery.xmlCount\n    ) {\n      setHasBattery(true);\n    }\n  }, [battery, localChanges]);\n\n\n  const batteryText = useMemo(() => battery && `${battery.ProductAccessoriesMap.count}  ${messages['local.item(s)']} ${battery.name}`, [battery, messages]);\n  const brandName = useMemo(() => getProductBrand(brand), [brand]);\n  const sizeText = useMemo(() => getProductSizeFromObj(size), [size]);\n  const productAga = useMemo(() => getProductAge(product.minAge, product.maxAge),\n    [product.minAge, product.maxAge]);\n\n  const photo = useMemo(() => {\n    const firstPhoto = photos ? photos.sort((a, b) => a.order - b.order)[0] : null;\n\n    if (!firstPhoto) return {};\n    return ({\n      url: `${IMAGE_POSTFIX}${id}/${firstPhoto.url}`,\n      alt: firstPhoto.alt,\n      title: firstPhoto.title,\n    });\n  }, [photos]);\n\n  const { newPrice, oldPrice } = useGetProductPrice(product);\n\n  const bonusText = useMemo(() => getBonus(newPrice, bonus || 2, count), [newPrice, bonus, count]);\n  const priceBayCount = useMemo(() => newPrice * count, [newPrice, count]);\n\n  const addToCart = (redirect) => {\n    cartAddProductAction(\n      addToCartObj({\n        hasBattery, battery, count, product,\n      }),\n      router.router.route === '/cart' || redirect,\n    );\n    handleHideModal();\n  };\n\n  const addToCartAndRedirect = () => {\n    addToCart(true);\n  };\n\n  const text2 = useCallback(\n    () => <span>{messages['local.can_use_bonus_if']}</span>,\n    [messages],\n  );\n\n\n  return {\n    addToCartAndRedirect,\n    addToCart,\n    bonusText,\n    batteryText,\n    brandName,\n    sizeText,\n    photo,\n    text,\n    setCount,\n    messages,\n    xmlPrice: oldPrice,\n    percent,\n    battery,\n    productAga,\n    text2,\n    id,\n    count,\n    hasBattery,\n    setHasBattery,\n    price,\n    xmlCount,\n    xmlBarCode,\n    priceBayCount,\n  };\n}\n\nexport default useBuyProductModal;\n"]},"metadata":{},"sourceType":"module"}