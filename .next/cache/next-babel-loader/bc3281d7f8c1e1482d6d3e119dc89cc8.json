{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _marked = /*#__PURE__*/_regeneratorRuntime.mark(changeUserCart),\n    _marked2 = /*#__PURE__*/_regeneratorRuntime.mark(getCartPageData),\n    _marked3 = /*#__PURE__*/_regeneratorRuntime.mark(getDataByPage),\n    _marked4 = /*#__PURE__*/_regeneratorRuntime.mark(workGetPageData),\n    _marked5 = /*#__PURE__*/_regeneratorRuntime.mark(watchGetPageData),\n    _marked6 = /*#__PURE__*/_regeneratorRuntime.mark(_callee5);\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { all, takeEvery, select, call, put } from 'redux-saga/effects';\nimport { getPageData, getPageDataSuccess, getPageDataError } from './action';\nimport { selectCurrentPage, selectPageId, selectHelperData } from './reducer'; // eslint-disable-next-line import/no-cycle\n\nimport Axios from '../services/Axios';\nimport { selectAuthorized, selectLang } from '../user/reducer';\nimport { cartSetAll } from '../cart/action';\nimport { setLocalStorageObj } from '../../constants/utils';\n\nvar getHomePageData = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(lang) {\n    var _yield$Axios$request, orders, _yield$Axios$request2, result, homePageData, newHomePageData, ExtraProducts, resultKeys;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return Axios.request({\n              url: '/api/product/sliders',\n              method: 'get'\n            });\n\n          case 3:\n            _yield$Axios$request = _context.sent;\n            orders = _yield$Axios$request.data.result.rows;\n            _context.next = 7;\n            return Axios.request({\n              url: '/api/product/homePage',\n              method: 'post',\n              data: {\n                lang: lang\n              }\n            });\n\n          case 7:\n            _yield$Axios$request2 = _context.sent;\n            result = _yield$Axios$request2.data.result;\n            homePageData = [];\n            newHomePageData = [];\n            ExtraProducts = result.ExtraProducts;\n            delete result.ExtraProducts;\n            resultKeys = Object.keys(result);\n            orders.forEach(function (currentOrder, index) {\n              var data = {};\n              resultKeys.forEach(function (key) {\n                if (result[key].sliderId === currentOrder.id) {\n                  data = result[key];\n                }\n              });\n              ExtraProducts.forEach(function (extra) {\n                if (extra.sliderId === currentOrder.id) {\n                  data = extra;\n                }\n              });\n              homePageData[currentOrder.order || 100 * index] = _objectSpread(_objectSpread({}, currentOrder), data);\n            });\n            homePageData.forEach(function (dataItem) {\n              if (dataItem) newHomePageData.push(dataItem);\n            });\n            return _context.abrupt(\"return\", newHomePageData);\n\n          case 19:\n            _context.prev = 19;\n            _context.t0 = _context[\"catch\"](0);\n            return _context.abrupt(\"return\", []);\n\n          case 22:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[0, 19]]);\n  }));\n\n  return function getHomePageData(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nvar getProfilePageData = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            return _context2.abrupt(\"return\", {\n              myOrders: [],\n              viewedProducts: [],\n              untilNextBonusPercent: 50000,\n              nextBonusPercent: 3\n            });\n\n          case 1:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function getProfilePageData() {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nvar getOneProductData = /*#__PURE__*/function () {\n  var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(lang, id) {\n    var _yield$Axios$request3, result;\n\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.next = 2;\n            return Axios.request({\n              method: 'post',\n              url: \"/api/product/\".concat(id),\n              data: {\n                id: id,\n                lang: lang\n              }\n            });\n\n          case 2:\n            _yield$Axios$request3 = _context3.sent;\n            result = _yield$Axios$request3.data.result;\n            return _context3.abrupt(\"return\", {\n              result: result\n            });\n\n          case 5:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n\n  return function getOneProductData(_x2, _x3) {\n    return _ref3.apply(this, arguments);\n  };\n}();\n\nfunction changeUserCart(products) {\n  return _regeneratorRuntime.wrap(function changeUserCart$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          _context4.next = 2;\n          return call(Axios.request, {\n            method: 'post',\n            url: '/api/user/addWish/byIds',\n            data: {\n              type: 'cart',\n              products: products\n            }\n          });\n\n        case 2:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, _marked);\n}\n\nfunction getCartPageData(_ref4) {\n  var lang, cart, ids, _yield$call, cartData, isAuth, newCart, _yield$call2, bugsData;\n\n  return _regeneratorRuntime.wrap(function getCartPageData$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          lang = _ref4.lang, cart = _ref4.cart;\n          ids = Object.keys(cart);\n          _context5.next = 4;\n          return call(Axios.request, {\n            url: '/api/product/byIds',\n            data: {\n              lang: lang,\n              ids: ids\n            },\n            method: 'post'\n          });\n\n        case 4:\n          _yield$call = _context5.sent;\n          cartData = _yield$call.data.result;\n\n          if (!(ids.length !== cartData.length)) {\n            _context5.next = 18;\n            break;\n          }\n\n          _context5.next = 9;\n          return select(selectAuthorized);\n\n        case 9:\n          isAuth = _context5.sent;\n          newCart = {};\n          cartData.forEach(function (_ref5) {\n            var id = _ref5.id;\n            newCart[id] = _objectSpread({}, cart[id]);\n          });\n          _context5.next = 14;\n          return put(cartSetAll({\n            cart: newCart\n          }));\n\n        case 14:\n          setLocalStorageObj('cart', newCart);\n\n          if (!isAuth) {\n            _context5.next = 18;\n            break;\n          }\n\n          _context5.next = 18;\n          return call(changeUserCart, Object.keys(newCart).map(function (key) {\n            return newCart[key];\n          }));\n\n        case 18:\n          _context5.next = 20;\n          return call(Axios.request, {\n            url: '/api/product/bugs',\n            data: {\n              lang: lang\n            },\n            method: 'post'\n          });\n\n        case 20:\n          _yield$call2 = _context5.sent;\n          bugsData = _yield$call2.data.result;\n          return _context5.abrupt(\"return\", {\n            cartData: cartData,\n            bugsData: bugsData\n          });\n\n        case 23:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  }, _marked2);\n}\n\nvar getVacancyPageData = /*#__PURE__*/function () {\n  var _ref7 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(_ref6) {\n    var lang, res;\n    return _regeneratorRuntime.wrap(function _callee4$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            lang = _ref6.lang;\n            _context6.next = 3;\n            return Axios.request({\n              url: '/api/vocation/',\n              data: {\n                lang: lang\n              },\n              method: 'post'\n            });\n\n          case 3:\n            res = _context6.sent;\n            return _context6.abrupt(\"return\", res);\n\n          case 5:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, _callee4);\n  }));\n\n  return function getVacancyPageData(_x4) {\n    return _ref7.apply(this, arguments);\n  };\n}();\n\nfunction getDataByPage(_ref8) {\n  var page, lang, id, data, res, _res, _res2, _res3, _yield$call3, result;\n\n  return _regeneratorRuntime.wrap(function getDataByPage$(_context7) {\n    while (1) {\n      switch (_context7.prev = _context7.next) {\n        case 0:\n          page = _ref8.page, lang = _ref8.lang, id = _ref8.id, data = _ref8.data;\n\n          if (!(page === 'home')) {\n            _context7.next = 6;\n            break;\n          }\n\n          _context7.next = 4;\n          return call(getHomePageData, lang);\n\n        case 4:\n          res = _context7.sent;\n          return _context7.abrupt(\"return\", res);\n\n        case 6:\n          if (!(page === 'profile')) {\n            _context7.next = 11;\n            break;\n          }\n\n          _context7.next = 9;\n          return call(getProfilePageData, lang);\n\n        case 9:\n          _res = _context7.sent;\n          return _context7.abrupt(\"return\", _res);\n\n        case 11:\n          if (!(page === 'oneProduct')) {\n            _context7.next = 16;\n            break;\n          }\n\n          _context7.next = 14;\n          return call(getOneProductData, lang, id);\n\n        case 14:\n          _res2 = _context7.sent;\n          return _context7.abrupt(\"return\", _res2);\n\n        case 16:\n          if (!(page === 'cart')) {\n            _context7.next = 21;\n            break;\n          }\n\n          _context7.next = 19;\n          return call(getCartPageData, {\n            lang: lang,\n            cart: data.cart\n          });\n\n        case 19:\n          _res3 = _context7.sent;\n          return _context7.abrupt(\"return\", _res3);\n\n        case 21:\n          if (!(page === 'vacancy')) {\n            _context7.next = 27;\n            break;\n          }\n\n          _context7.next = 24;\n          return call(getVacancyPageData, {\n            lang: lang\n          });\n\n        case 24:\n          _yield$call3 = _context7.sent;\n          result = _yield$call3.data.result;\n          return _context7.abrupt(\"return\", result);\n\n        case 27:\n          return _context7.abrupt(\"return\", null);\n\n        case 28:\n        case \"end\":\n          return _context7.stop();\n      }\n    }\n  }, _marked3);\n}\n\nfunction workGetPageData(action) {\n  var _action$payload, page, id, data, lang, currentId, currentPage, helperData, res;\n\n  return _regeneratorRuntime.wrap(function workGetPageData$(_context8) {\n    while (1) {\n      switch (_context8.prev = _context8.next) {\n        case 0:\n          _context8.prev = 0;\n          _action$payload = action.payload, page = _action$payload.page, id = _action$payload.id, data = _action$payload.data;\n          _context8.next = 4;\n          return select(selectLang);\n\n        case 4:\n          lang = _context8.sent;\n          _context8.t0 = id;\n\n          if (_context8.t0) {\n            _context8.next = 10;\n            break;\n          }\n\n          _context8.next = 9;\n          return select(selectPageId);\n\n        case 9:\n          _context8.t0 = _context8.sent;\n\n        case 10:\n          currentId = _context8.t0;\n          _context8.t1 = page;\n\n          if (_context8.t1) {\n            _context8.next = 16;\n            break;\n          }\n\n          _context8.next = 15;\n          return select(selectCurrentPage);\n\n        case 15:\n          _context8.t1 = _context8.sent;\n\n        case 16:\n          currentPage = _context8.t1;\n          _context8.t3 = data;\n\n          if (_context8.t3) {\n            _context8.next = 22;\n            break;\n          }\n\n          _context8.next = 21;\n          return select(selectHelperData);\n\n        case 21:\n          _context8.t3 = _context8.sent;\n\n        case 22:\n          _context8.t2 = _context8.t3;\n\n          if (_context8.t2) {\n            _context8.next = 25;\n            break;\n          }\n\n          _context8.t2 = null;\n\n        case 25:\n          helperData = _context8.t2;\n          _context8.next = 28;\n          return call(getDataByPage, {\n            page: currentPage,\n            lang: lang,\n            id: currentId,\n            data: helperData\n          });\n\n        case 28:\n          res = _context8.sent;\n          _context8.next = 31;\n          return put(getPageDataSuccess({\n            data: res,\n            page: currentPage,\n            id: currentId,\n            helperData: helperData\n          }));\n\n        case 31:\n          _context8.next = 37;\n          break;\n\n        case 33:\n          _context8.prev = 33;\n          _context8.t4 = _context8[\"catch\"](0);\n          _context8.next = 37;\n          return put(getPageDataError());\n\n        case 37:\n        case \"end\":\n          return _context8.stop();\n      }\n    }\n  }, _marked4, null, [[0, 33]]);\n}\n\nfunction watchGetPageData() {\n  return _regeneratorRuntime.wrap(function watchGetPageData$(_context9) {\n    while (1) {\n      switch (_context9.prev = _context9.next) {\n        case 0:\n          _context9.next = 2;\n          return takeEvery(getPageData, workGetPageData);\n\n        case 2:\n        case \"end\":\n          return _context9.stop();\n      }\n    }\n  }, _marked5);\n}\n\nexport default function _callee5() {\n  return _regeneratorRuntime.wrap(function _callee5$(_context10) {\n    while (1) {\n      switch (_context10.prev = _context10.next) {\n        case 0:\n          _context10.next = 2;\n          return all([watchGetPageData()]);\n\n        case 2:\n        case \"end\":\n          return _context10.stop();\n      }\n    }\n  }, _marked6);\n}","map":null,"metadata":{},"sourceType":"module"}