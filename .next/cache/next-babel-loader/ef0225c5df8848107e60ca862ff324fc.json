{"ast":null,"code":"var __jsx = React.createElement;\nimport React, { useState, useMemo, useEffect, useCallback } from 'react';\nimport { useIntl } from 'react-intl';\nimport useCartActions from '../../../store/cart/useCartActions';\nimport { getProductSizeFromObj, getBonus, getProductBrand, getProductAge, getProductBattery, addToCartObj } from '../../../constants/utils';\nimport keys from '../../../constants/keys';\nconst {\n  IMAGE_POSTFIX\n} = keys;\n\nfunction useBuyProductModal({\n  product,\n  localChanges,\n  handleHideModal,\n  bonus\n}) {\n  const {\n    cartAddProductAction\n  } = useCartActions();\n  const {\n    messages\n  } = useIntl();\n\n  const text = __jsx(\"span\", null, messages['local.modal_battery']);\n\n  const {\n    size,\n    brand,\n    id,\n    percent,\n    price,\n    accessories,\n    xmlPrice,\n    photos,\n    xmlCount,\n    xmlBarCode\n  } = product;\n  const {\n    0: hasBattery,\n    1: setHasBattery\n  } = useState(false);\n  const {\n    0: count,\n    1: setCount\n  } = useState(localChanges[product.id] && localChanges[product.id].count || product.count || 1);\n  const battery = useMemo(() => getProductBattery(accessories), [accessories]);\n  useEffect(() => {\n    if (battery && localChanges[id] && (localChanges[id].hasBattery || localChanges[id].batteryId) && battery.xmlCount) {\n      setHasBattery(true);\n    }\n  }, [battery, localChanges]);\n  const batteryText = useMemo(() => battery && `${battery.ProductAccessoriesMap.count} ${battery.name}`, [battery]);\n  const brandName = useMemo(() => getProductBrand(brand), [brand]);\n  const sizeText = useMemo(() => getProductSizeFromObj(size), [size]);\n  const productAga = useMemo(() => getProductAge(product.minAge, product.maxAge), [product.minAge, product.maxAge]);\n  const photo = useMemo(() => photos ? {\n    url: `${IMAGE_POSTFIX}${id}/${photos[0].url}`,\n    alt: photos[0].alt,\n    title: photos[0].title\n  } : {}, [photos]);\n  const bonusText = useMemo(() => getBonus(price, bonus || 2, count), [price, bonus, count]);\n  const priceBayCount = useMemo(() => price * count, [price, count]);\n\n  const addToCart = redirect => {\n    cartAddProductAction(addToCartObj({\n      hasBattery,\n      battery,\n      count,\n      product\n    }), redirect);\n    handleHideModal();\n  };\n\n  const addToCartAndRedirect = () => {\n    addToCart(true);\n  };\n\n  const text2 = useCallback(() => __jsx(\"span\", null, messages['local.can_use_bonus_if']), [messages]);\n  return {\n    addToCartAndRedirect,\n    addToCart,\n    bonusText,\n    batteryText,\n    brandName,\n    sizeText,\n    photo,\n    text,\n    setCount,\n    messages,\n    xmlPrice,\n    percent,\n    battery,\n    productAga,\n    text2,\n    id,\n    count,\n    hasBattery,\n    setHasBattery,\n    price,\n    xmlCount,\n    xmlBarCode,\n    priceBayCount\n  };\n}\n\nexport default useBuyProductModal;","map":null,"metadata":{},"sourceType":"module"}