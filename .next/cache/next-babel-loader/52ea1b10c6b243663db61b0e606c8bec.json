{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _marked = /*#__PURE__*/_regeneratorRuntime.mark(workGetViewedProducts),\n    _marked2 = /*#__PURE__*/_regeneratorRuntime.mark(watchGetViewedProducts),\n    _marked3 = /*#__PURE__*/_regeneratorRuntime.mark(workSetViewedProducts),\n    _marked4 = /*#__PURE__*/_regeneratorRuntime.mark(watchSetViewedProducts),\n    _marked5 = /*#__PURE__*/_regeneratorRuntime.mark(_callee2);\n\nimport { all, put, call, select, takeEvery } from 'redux-saga/effects';\nimport Axios from '../services/Axios';\nimport { getViewedProducts, getViewedProductsError, getViewedProductsSuccess, setViewedProducts } from './action';\nimport { getLocalStorageObj, setLocalStorageObj } from '../../constants/utils';\nimport { selectLang, selectAuthorized } from '../user/reducer';\n\nvar getProductsByIds = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref) {\n    var lang, ids, _yield$Axios$request, result, newIds, r;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            lang = _ref.lang, ids = _ref.ids;\n            _context.next = 3;\n            return Axios.request({\n              url: '/api/product/byIds',\n              data: {\n                lang: lang,\n                ids: ids\n              },\n              method: 'post'\n            });\n\n          case 3:\n            _yield$Axios$request = _context.sent;\n            result = _yield$Axios$request.data.result;\n            newIds = ids.filter(function (id) {\n              return result.find(function (_ref3) {\n                var prodId = _ref3.id;\n                return prodId === id;\n              });\n            });\n            r = [];\n            result.forEach(function (a) {\n              r[newIds.indexOf(a.id)] = a;\n            });\n            return _context.abrupt(\"return\", r.reverse());\n\n          case 9:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function getProductsByIds(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nfunction workGetViewedProducts(action) {\n  var limit, viewedProductIds, lang, res;\n  return _regeneratorRuntime.wrap(function workGetViewedProducts$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          limit = action.payload.limit;\n          _context2.prev = 1;\n          viewedProductIds = getLocalStorageObj('viewed') || [];\n\n          if (!limit && viewedProductIds.length > 6) {\n            viewedProductIds = viewedProductIds.splice(viewedProductIds.length - 6, 6);\n          } else if (limit && viewedProductIds.length > limit) {\n            viewedProductIds = viewedProductIds.splice(viewedProductIds.length - limit, limit);\n          }\n\n          _context2.next = 6;\n          return select(selectLang);\n\n        case 6:\n          lang = _context2.sent;\n          _context2.next = 9;\n          return call(getProductsByIds, {\n            ids: viewedProductIds,\n            lang: lang\n          });\n\n        case 9:\n          res = _context2.sent;\n          _context2.next = 12;\n          return put(getViewedProductsSuccess({\n            data: res\n          }));\n\n        case 12:\n          _context2.next = 18;\n          break;\n\n        case 14:\n          _context2.prev = 14;\n          _context2.t0 = _context2[\"catch\"](1);\n          _context2.next = 18;\n          return put(getViewedProductsError());\n\n        case 18:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked, null, [[1, 14]]);\n}\n\nfunction watchGetViewedProducts() {\n  return _regeneratorRuntime.wrap(function watchGetViewedProducts$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          _context3.next = 2;\n          return takeEvery(getViewedProducts, workGetViewedProducts);\n\n        case 2:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, _marked2);\n}\n\nfunction workSetViewedProducts(_ref4) {\n  var id, authorizedUser, lastViewed;\n  return _regeneratorRuntime.wrap(function workSetViewedProducts$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          id = _ref4.payload.id;\n          _context4.next = 3;\n          return select(selectAuthorized);\n\n        case 3:\n          authorizedUser = _context4.sent;\n\n          try {\n            if (authorizedUser) {// send api to watched products\n            }\n\n            lastViewed = getLocalStorageObj('viewed') || [];\n\n            if (lastViewed.indexOf(id) === -1) {\n              lastViewed.push(id);\n              setLocalStorageObj('viewed', lastViewed);\n            }\n          } catch (error) {\n            console.log('error', error);\n          }\n\n        case 5:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, _marked3);\n}\n\nfunction watchSetViewedProducts() {\n  return _regeneratorRuntime.wrap(function watchSetViewedProducts$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          _context5.next = 2;\n          return takeEvery(setViewedProducts, workSetViewedProducts);\n\n        case 2:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  }, _marked4);\n}\n\nexport default function _callee2() {\n  return _regeneratorRuntime.wrap(function _callee2$(_context6) {\n    while (1) {\n      switch (_context6.prev = _context6.next) {\n        case 0:\n          _context6.next = 2;\n          return all([watchGetViewedProducts(), watchSetViewedProducts()]);\n\n        case 2:\n        case \"end\":\n          return _context6.stop();\n      }\n    }\n  }, _marked5);\n}","map":{"version":3,"sources":["/var/www/mankan-front/store/viewed-products/saga.js"],"names":["workGetViewedProducts","watchGetViewedProducts","workSetViewedProducts","watchSetViewedProducts","all","put","call","select","takeEvery","Axios","getViewedProducts","getViewedProductsError","getViewedProductsSuccess","setViewedProducts","getLocalStorageObj","setLocalStorageObj","selectLang","selectAuthorized","getProductsByIds","lang","ids","request","url","data","method","result","newIds","filter","id","find","prodId","r","forEach","a","indexOf","reverse","action","limit","payload","viewedProductIds","length","splice","res","authorizedUser","lastViewed","push","error","console","log"],"mappings":"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","sourcesContent":["import {\n  all, put, call, select, takeEvery,\n} from 'redux-saga/effects';\nimport Axios from '../services/Axios';\nimport {\n  getViewedProducts, getViewedProductsError, getViewedProductsSuccess, setViewedProducts,\n} from './action';\nimport { getLocalStorageObj, setLocalStorageObj } from '../../constants/utils';\nimport { selectLang, selectAuthorized } from '../user/reducer';\n\n\nconst getProductsByIds = async ({ lang, ids }) => {\n  const { data: { result } } = await Axios.request({\n    url: '/api/product/byIds',\n    data: { lang, ids },\n    method: 'post',\n  });\n\n  const newIds = ids.filter((id) => result.find(({ id: prodId }) => prodId === id));\n\n  const r = [];\n\n  result.forEach((a) => {\n    r[newIds.indexOf(a.id)] = a;\n  });\n\n  return r.reverse();\n};\nfunction* workGetViewedProducts(action) {\n  const { payload: { limit } } = action;\n  try {\n    let viewedProductIds = getLocalStorageObj('viewed') || [];\n    if (!limit && viewedProductIds.length > 6) {\n      viewedProductIds = viewedProductIds.splice(viewedProductIds.length - 6, 6);\n    } else if (limit && viewedProductIds.length > limit) {\n      viewedProductIds = viewedProductIds.splice(viewedProductIds.length - limit, limit);\n    }\n\n    const lang = yield select(selectLang);\n    const res = yield call(getProductsByIds, { ids: viewedProductIds, lang });\n\n    yield put(getViewedProductsSuccess({ data: res }));\n  } catch (error) {\n    yield put(getViewedProductsError());\n  }\n}\n\nfunction* watchGetViewedProducts() {\n  yield takeEvery(getViewedProducts, workGetViewedProducts);\n}\n\nfunction* workSetViewedProducts({ payload: { id } }) {\n  const authorizedUser = yield select(selectAuthorized);\n  try {\n    if (authorizedUser) {\n      // send api to watched products\n    }\n    const lastViewed = getLocalStorageObj('viewed') || [];\n    if (lastViewed.indexOf(id) === -1) {\n      lastViewed.push(id);\n      setLocalStorageObj('viewed', lastViewed);\n    }\n  } catch (error) {\n    console.log('error', error);\n  }\n}\n\nfunction* watchSetViewedProducts() {\n  yield takeEvery(setViewedProducts, workSetViewedProducts);\n}\n\n\nexport default function* () {\n  yield all([\n    watchGetViewedProducts(),\n    watchSetViewedProducts(),\n  ]);\n}\n"]},"metadata":{},"sourceType":"module"}