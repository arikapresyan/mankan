{"ast":null,"code":"import { useFormik } from 'formik';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { useCallback, useEffect, useMemo, useState } from 'react';\nimport { useIntl } from 'react-intl';\nimport { message } from 'antd';\nimport { selectUser } from '../../../../store/user/reducer';\nimport { getSingleData } from '../../../../store/single-data/action';\nimport { selectSingleData } from '../../../../store/single-data/reducer';\nimport { getInitialValues, MIN_TOTAL } from './constants';\nimport { sendOrder } from '../../../../store/cart/action';\nimport { getOrderSchema } from '../../../../utils/validationSchemas';\nimport { getBonus } from '../../../../constants/utils';\nexport default function useConfirmOrder(handleHideModal, data) {\n  var _useIntl = useIntl(),\n      messages = _useIntl.messages,\n      formatMessage = _useIntl.formatMessage;\n\n  var user = useSelector(selectUser);\n  var dispatch = useDispatch();\n\n  var _useSelector = useSelector(selectSingleData),\n      singleData = _useSelector.paymentDelivery;\n\n  var orderStatus = useSelector(function (_ref) {\n    var cart = _ref.cart;\n    return cart.order;\n  });\n  var initialValues = useMemo(function () {\n    return getInitialValues(user);\n  }, []);\n  var sendOrderAction = useCallback(function (payload) {\n    dispatch(sendOrder(payload));\n  }, []);\n  var cartData = data.cartData,\n      promoCodeData = data.promoCodeData,\n      bonusPercent = data.bonusPercent;\n  var fullPrice = useMemo(function () {\n    return cartData.reduce(function (a, b) {\n      return (a.xmlPrice * a.count || a) + b.xmlPrice * b.count;\n    }, 0);\n  }, []);\n  var fullNewPrice = useMemo(function () {\n    var reduce = cartData.reduce(function (a, b) {\n      return (a.price * a.count || a) + b.price * b.count;\n    }, 0);\n    return promoCodeData ? reduce * (100 - promoCodeData.percent) / 100 : reduce;\n  }, // zexchel\n  [promoCodeData, cartData]);\n  var bonus = useMemo(function () {\n    return bonusPercent && getBonus(fullNewPrice, bonusPercent, 1);\n  }, [bonusPercent, fullNewPrice]);\n  var deliveryPrice = useMemo(function () {\n    return fullNewPrice > 20000 ? 0 : 800;\n  }, [fullNewPrice]);\n  var total = useMemo(function () {\n    return fullNewPrice + deliveryPrice;\n  }, [fullNewPrice, deliveryPrice]);\n\n  var _useState = useState({\n    time: [],\n    days: []\n  }),\n      dateInfo = _useState[0],\n      setDateInfo = _useState[1];\n\n  useEffect(function () {\n    dispatch(getSingleData({\n      data: {\n        name: 'paymentDelivery'\n      }\n    }));\n  }, [getSingleData, dispatch]);\n  useEffect(function () {\n    if (singleData.data && !dateInfo.days.length) {\n      setDateInfo(singleData.data);\n    }\n  }, [singleData]);\n  var validationSchema = useMemo(function () {\n    return getOrderSchema(messages);\n  }, [messages]);\n  var formik = useFormik({\n    initialValues: initialValues,\n    validationSchema: validationSchema,\n    onSubmit: function onSubmit(values) {\n      if (values.method === 3 && user.bonus < total) {\n        message.warning(messages['local.not_enough_bonus']);\n        return;\n      }\n\n      if (total < MIN_TOTAL) {\n        message.warning(formatMessage({\n          id: 'local.min_price_of_order'\n        }, {\n          price: MIN_TOTAL\n        }));\n        return;\n      }\n\n      var messageTexts = {\n        errorText: messages['local.errorText'],\n        successText: messages['local.successText']\n      };\n      sendOrderAction({\n        values: values,\n        messageTexts: messageTexts,\n        promo: promoCodeData === null || promoCodeData === void 0 ? void 0 : promoCodeData.code\n      });\n    }\n  });\n  useEffect(function () {\n    if (!orderStatus.loading && !orderStatus.error && formik.isSubmitting) handleHideModal();\n  }, [orderStatus]);\n  return {\n    formik: formik,\n    dateInfo: dateInfo,\n    loading: orderStatus.loading,\n    other: {\n      bonus: bonus,\n      total: total,\n      deliveryPrice: deliveryPrice,\n      fullNewPrice: fullNewPrice,\n      fullPrice: fullPrice\n    }\n  };\n}","map":null,"metadata":{},"sourceType":"module"}